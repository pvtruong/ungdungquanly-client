var $jscomp={scope:{},findInternal:function(c,t,q){c instanceof String&&(c=String(c));for(var v=c.length,h=0;h<v;h++){var y=c[h];if(t.call(q,y,h,c))return{i:h,v:y}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(c,t,q){if(q.get||q.set)throw new TypeError("ES3 does not support getters and setters.");c!=Array.prototype&&c!=Object.prototype&&(c[t]=q.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,t,q,v){if(t){q=$jscomp.global;c=c.split(".");for(v=0;v<c.length-1;v++){var h=c[v];h in q||(q[h]={});q=q[h]}c=c[c.length-1];v=q[c];t=t(v);t!=v&&null!=t&&$jscomp.defineProperty(q,c,{configurable:!0,writable:!0,value:t})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,q){return $jscomp.findInternal(this,c,q).v}},"es6-impl","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(c){var t=0;return $jscomp.iteratorPrototype(function(){return t<c.length?{done:!1,value:c[t++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(c,t){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var q=0,v={next:function(){if(q<c.length){var h=q++;return{value:t(h,c[h]),done:!1}}v.next=function(){return{done:!0,value:void 0}};return v.next()}};v[Symbol.iterator]=function(){return v};return v};
$jscomp.polyfill("Array.prototype.values",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c,q){return q})}},"es6","es3");
var getTemplate=function(c,t,q){q||(q=60);q='<div style="height:{{innerHeight}}px"><div class="modal-header section-info"><button type="button" class="close" ng-click ="close()" aria-hidden="true"> &times;</button><h4 class="modal-title" id="findModalLabel">   {{title||"::"}}</h4></div><div class="modal-body"  style="height:{{innerHeight-'+q.toString()+'}}px">';return q=q+(t||"  <"+c+"-form></"+c+"-form>")+"</div></div>"},viewProfile=function(c,t){c.open({templateUrl:"templates/sys/profile.html",
controller:["$scope","$uibModalInstance","user","$location","$rootScope",function(c,v,h,y,k){h.getProfile(t,function(h,a){c.profile=a});c.cancel=function(){v.close()};c.gotoChat=function(c){v.close();y.path("/message/chat/"+c)};c.current_User=c.currentUser=k.user}],size:"md"})},baseInput=function(c,t,q,v,h){c&&(STPModules[c.toLowerCase()]={obj:this,type:"INPUT"});this.code=c;this.server_path=t;this.fields_find=q;this.title=v;h||(h={});h.limit||(h.limit=30);this.options=h;this.group=h.group;this.group||
(this.group="lists");this.defaultConditions=h.defaultConditions;this.defaultValues=h.defaultValues;this.loading=h.onLoading;this.loaded=h.onLoaded;this.initHomeController=h.onInitHomeController;this.initAddController=h.onInitAddController;this.initEditController=h.onInitEditController;this.init=h.onInit;this.setDataSource2Print=h.onSetDataSource2Print;this.loadItem=h.onLoadItem;this.initImport=h.onImport;this.defaultCondition4Search=h.defaultCondition4Search;this.prepareCondition4Search=h.onPrepareCondition4Search;
var y=c+"Module";_.contains(modulesD,y)||modulesD.push(y);this.module=angular.module(y,["ngRoute"]);var k=this;this.module.factory(c+"Config",function(){return{title:v,path:c}});this.url_service=function(c){return _.contains(paths_not_require_id_app,t)?(c&&servers[c]?servers[c]:server_url)+"/api/"+t:(c&&servers[c]?servers[c]:server_url)+"/api/"+id_app+"/"+t};this.getService=function(c,a,b){return baseService2(b,c,a,t,k.url_service,q,h.services)};this.module.factory(c,["$http","$q","$rootScope",function(c,
a,b){return k.getService(c,a,b)}]);this.download=function(c,a,b,h,l){l||(l=function(){});c=k.getService(c,a,b);(b=b.sync_date)||(b=moment().year(1999).startOf("date").toDate());c.load(id_app,{limit:h,condition:{sync_from_date:b}}).then(function(a){l()},function(a){a.data?l(a.data):l("Kh\u00f4ng th\u1ec3 k\u1ebft n\u1ed1i v\u1edbi m\u00e1y ch\u1ee7")})};this.module.controller(c+"JsonController",["$controller","$scope","$http",c,"$location",c+"Config","$rootScope","$window","$interval","$uibModal",
"$filter","appInfo","$localStorage",function(A,a,b,z,l,f,d,m,p,C,w,E,q){a.list=[];a.condition="";k.defaultConditions&&(a.condition={},_.extend(a.condition,k.defaultConditions));angular.extend(a,f);a.limit=3E4;var x=l.search();E.info(c,function(b,c,f){b||(a.list=[],z.load(id_app,{condition:a.condition,filter:a.filter,page:1,limit:a.limit,queryParams:x,onCondition:h.onCondition}).then(function(b){a.list=b.data},function(a){(a=a.data)&&d.alert(a)}))})}]);this.module.controller(c+"HomeController",["$q",
"$controller","$scope","$shttp",c,"$location",c+"Config","$rootScope","$window","$interval","$uibModal","$filter","appInfo","$localStorage","$cordovaBarcodeScanner","follow","rpt","printFactory",function(A,a,b,z,l,f,d,m,p,C,w,E,q,x,y,G,u,I){initLabel(m,b,q,c,z);var H,F={};b.isListView||(m.function_title=v,m.function_code=c,F=f.search());b.list=[];angular.extend(b,d);b.condition="";b.filter||(b.filter={});b.limit||(b.limit=h.limit);k.defaultConditions&&_.extend(b.filter,k.defaultConditions);b.parameters&&
_.extend(b.filter,b.parameters);b.total_page=1;b.current_page=1;b.pages=[1];b.$uibModal=w;b.$http=z;b.config=d;k.init&&k.init(b,a,{$http:z});b.limitOpts={limit:b.limit,begin:0};b.loadPage=function(){b.limitOpts.limit+=5};q.info(c,function(D,B,N){if(!D){k.loading&&m.nextTick(function(){k.loading(b,{$q:A,$controller:a,$http:z,service:l,$filter:E,$location:f,config:d,$rootScope:m,$window:p,$interval:C,$uibModal:w})});b.current_user=m.user;b.pageBar={};b.goToPage=function(r,g,c){b.selectedRow=null;b.limitOpts.limit=
b.limit;b.list=[];b.current_page=r;b.pageBar.current_page=r;if(b.notLoadData)return b.renderCompleted=!0,console.log("Don't allow load data");m.nextTick(function(){b.$emit("$dataChangeStart");b.list=[];g||void 0!=g||(g=H||b.condition);if(b.findBy&&!_.isObject(g)){var K=g;g={};g[b.findBy]={$regex:K,$options:"i"}}if(L())return console.log("reload when begin fetch data from server");H=g;l.load(id_app,{condition:g,filter:b.filter,page:r,limit:b.limit,queryParams:F,onCondition:h.onCondition,fields_find:b.fields_find}).then(function(r){if(L())return console.log("reload when fetch data from server completed");
l.load(id_app,{condition:g,filter:b.filter,count:1,queryParams:F,onCondition:h.onCondition,fields_find:b.fields_find}).then(function(a){b.rows_number=a.data.rows_number;b.total_page=STP.round(a.data.rows_number/Number(b.limit),0);b.total_page<a.data.rows_number/Number(b.limit)&&(b.total_page+=1);0==b.total_page&&(b.total_page=1);b.pages=[];for(a=1;a<=b.total_page;a++)b.pages.push(a)});var K=r.data;async.map(K,function(a,g){id_app&&_online?G.load(id_app,{filter:{id_object:a._id,user_created:b.current_user.email}}).then(function(b){(b=
b.data)&&0<b.length?(a.followObject=b[0],a.follow_yn=1):a.follow_yn=0;g()},function(b){a.follow_yn=0;g(e.data)}):g()},function(g,r){g&&console.log(g);if(L())return console.log("reload when near finish");b.list=E("orderBy")(K,h.predicate||"ngay_tao",!1);0<b.list.length&&b.setSelectedRow(b.list[0],!0);b.renderCompleted=!0;c&&c(null,b.list);k.loaded&&m.nextTick(function(){k.loaded(b,{$controller:a,$http:z,service:l,$filter:E,$location:f,config:d,$rootScope:m,$window:p,$interval:C,$uibModal:w})});b.$emit("$dataChangeSuccess")})},
function(g){if(L())return console.log("reload when error");g=g.data;console.log(g);b.$emit("$dataChangeError");c&&c(g);k.loaded&&m.nextTick(function(){k.loaded(b,{$controller:a,$http:z,service:l,$filter:E,$location:f,config:d,$rootScope:m,$window:p,$interval:C,$uibModal:w})})})})};b.goToPage(1,null,function(a){a&&m.alert(a)});b.update=function(a,g,c){b.$emit("$dataSaveStart");l.update(id_app,a._id,a).then(function(r){r=r.data;a.updated=!0;b.$emit("$dataSaveSuccess");c&&angular.extend(c,r);g?g(null,
r):m.toast("\u0110\u00e3 c\u1eadp nh\u1eadt th\u00e0nh c\u00f4ng")},function(a){a=a.data;b.$emit("$dataSaveError");if(!a)return m.alert("Kh\u00f4ng th\u1ec3 k\u1ebft n\u1ed1i v\u1edbi m\u00e1y ch\u1ee7");a=JSON.stringify(a);if(0>a.indexOf("L\u1ed7i")){if(0<=a.indexOf("duplicate"))return m.alert("L\u1ed7i: \u0110\u00e3 t\u1ed3n t\u1ea1i");if(0<=a.indexOf("Not allowed"))return m.alert("L\u1ed7i: B\u1ea1n kh\u00f4ng c\u00f3 quy\u1ec1n th\u1ef1c hi\u1ec7n thao t\u00e1c n\u00e0y")}a=JSON.parse(a);g?g(a):
angular.isArray(a)?m.alert(a.join("\n")):m.alert(a)})};b.add=function(a){a||(a={});if(k.defaultvalues){var g=JSON.parse(JSON.stringify(k.defaultvalues));_.extend(a,g)}b.parameters&&_.extend(a,b.parameters);k.quickadd(w,function(a){_.find(b.list,function(b){return b._id===a._id})||(b.list=[a].concat(b.list));b.setSelectedRow(a,!0)},a)};b.copy=function(a,g,c){c||(c=function(){});var r={};_.extend(r,a);delete r._id;delete r.so_ct;delete r.ngay_ct;delete r.__v;delete r.date_created;delete r.date_updated;
delete r.user_created;delete r.user_updated;delete r.stt_rec;delete r.id_pc0;delete r.id_pc3;delete r.id_pc2;delete r.id_contract;delete r.id_bao_gia;for(var d in r)0==d.indexOf("id_")&&delete r[d];b.parameters&&_.extend(r,b.parameters);g&&_.extend(r,g);k.quickadd(w,function(a){_.find(b.list,function(b){return b._id===a._id})||(b.list=[a].concat(b.list));b.setSelectedRow(a,!0);c(a)},r)};b.xemhoachtoan=function(a){w.open({templateUrl:"templates/sys/xemhoachtoan.html",controller:["$scope","$rootScope",
"$controller","$http","$uibModalInstance","appInfo",function(b,r,c,d,f,B){initLabel(r,b,B,"SYS",d);b.data=a;l.getSocai(a.id_app,a._id).then(function(a){b.socai=a.data},function(a){f.close();a.data&&r.alert(a.data)});b.close=function(){f.close()}}],size:h.modal_size||"sm",resolve:{parentScope:function(){return b}}})};b.xemsokho=function(a){w.open({templateUrl:"templates/sys/xemsokho.html",controller:["$scope","$rootScope","$controller","$http","$uibModalInstance","appInfo",function(b,r,c,d,f,B){initLabel(r,
b,B,"SYS",d);b.data=a;l.getSokho(a.id_app,a._id).then(function(a){b.sokho=a.data},function(a){f.close();a.data&&r.alert(a.data)});b.close=function(){f.close()}}],size:h.modal_size||"sm",resolve:{parentScope:function(){return b}}})};b.xemlogs=function(a){w.open({templateUrl:"templates/sys/logs.html",controller:["$scope","$rootScope","$controller","$http","$uibModalInstance","$window","appInfo",function(b,r,d,f,B,h,k){initLabel(r,b,k,"SYS",f);b.data=a;b.module=c;b.close=function(){B.close()}}],size:h.modal_size||
"sm",resolve:{parentScope:function(){return b}}})};b.xemDeleted=function(){w.open({templateUrl:"templates/sys/deleted.html",controller:["$scope","$rootScope","$controller","$http","$uibModalInstance","$window","appInfo",c,function(a,b,c,d,f,B,h,D){initLabel(b,a,h,"SYS",d);a.data=[];a.fields_find=k.fields_find;D.logs(id_app,"DELETE").then(function(b){a.data=b.data},function(a){if(a.data)return b.alert(a.data)});a.close=function(){f.close()};a.restore=function(g){var r=g._id.toString();delete g.data.data.stt_rec;
k.quickadd(w,function(g){url=server_url+"/api/"+id_app+"/log/"+r;d.delete(url).then(function(b){a.data=_.filter(a.data,function(a){return a._id.toString()!==r})},function(a){a.data&&b.alert(a.data)})},g.data.data)}}],size:h.modal_size||"sm",resolve:{parentScope:function(){return b}}})};b.edit=function(a){var g=_.find(b.list,function(b){return b._id===a});!g||b.selectedRow&&b.selectedRow._id===g._id||b.setSelectedRow(g);if(b.isListView&&b.onListItemClick)b.onListItemClick({$item:g});else k.quickedit(w,
a,function(a,r){b.selectedRow&&b.selectedRow._id===a._id&&_.extend(b.selectedRow,a);g&&"delete"!==r&&(_.extend(g,a),m.toast("\u0110\u00e3 c\u1eadp nh\u1eadt th\u00e0nh c\u00f4ng"))},function(a){b.list=_.reject(b.list,function(b){return b._id===a._id});d.list=b.list})};b.view=function(a){if(b.isListView)return b.edit(a);h.has_view?f.path("/"+b.path+"/view/"+(_.isObject(a)?a._id:a)):b.edit(a)};b.isEqual=function(a,b){return angular.equals(a,b)};b.setSelectedRow=function(a,g){b.selectedRow&&b.selectedRow._id===
a._id?g&&b.edit(a._id):b.selectedRow=g?JSON.parse(JSON.stringify(a)):a};b.openProfile=function(a){viewProfile(w,a)};b.searchKeyup=function(a,g){13==a.keyCode&&b.search(g)};b.search=function(a,g){b.renderCompleted&&(a&&console.log(c,"search by condition",a),b.renderCompleted=!1,b.goToPage(1,a,function(){0==b.list.length&&m.toast("Kh\u00f4ng t\u00ecm th\u1ea5y d\u1eef li\u1ec7u");g&&g(b.list)}))};b.searchBarcode=function(){document.addEventListener("deviceready",function(){y.scan().then(function(a){b.condition=
a.text;b.search(a.text,function(a){if(1===a.length&&b.onRowClick)b.onRowClick({$item:a[0]})})},function(a){})},!1)};b.searchByField=function(a,g,c){var r={};m.prompt("Nh\u1eadp gi\u00e1 tr\u1ecb c\u1ea7n t\u00ecm:","Number"==c?0:"").then(function(d){if(1==d.buttonIndex&&(g||(g="regex"),c||(c="String"),(d=d.input1)||0==d)){if("Number"==c){try{d=Number(d)}catch(O){}d||(d=0)}switch(g){case "=":r[a]=d;break;case ">":r[a]={$gte:d};break;case "<":r[a]={$lte:d};break;default:r[a]={$regex:d,$option:"i"}}b.search(r)}})};
b.find=function(){w.open({templateUrl:"templates/"+k.group+"/"+c+"/templates/find.html",controller:["$scope","$uibModalInstance","parentScope",function(a,b,c){a.vcondition={};k.defaultCondition4Search&&(a.vcondition=k.defaultCondition4Search);a.list=c.list;a.search=c.search;a.okFind=function(){var g={};if(k.prepareCondition4Search)g=k.prepareCondition4Search(a,a.vcondition);else for(var c in a.vcondition)a.vcondition[c]&&(_.isString(a.vcondition[c])?g[c]={$regex:a.vcondition[c],$options:"i"}:g[c]=
a.vcondition[c]);g.ngay_ct&&(g.ngay_ct.$gte&&(g.ngay_ct.$gte=moment(g.ngay_ct.$gte).startOf("date").toDate()),g.ngay_ct.$lte&&(g.ngay_ct.$lte=moment(g.ngay_ct.$lte).endOf("date").toDate()));a.vcondition.trang_thai&&!g.trang_thai&&(g.trang_thai=a.vcondition.trang_thai);a.search(g);b.close()};a.cancelFind=function(){b.close()}}],size:"sm",resolve:{parentScope:function(){return b}}})};b.changeLimit=function(a){b.limit=a;b.search()};b.changeFilter=function(a){b.findBy=null;b.filter=a.filter;b.filter_title=
450>=window.innerWidth?13>a.title.length?a.title:"..."+a.title.slice(-10):a.title;b.search()};var L=function(){return b.reload?(b.reload=!1,b.renderCompleted=!0,console.log("run reload when parameters changed",c,n),b.search(),!0):!1};b.$watch("parameters",function(a,g){a&&!_.isEqual(a,g)&&(b.filter={},_.extend(b.filter,a),b.renderCompleted=!1,console.log("search when parameters changed",c,a),b.renderCompleted=!0,b.search())},!0);b.$watch("requireReload",function(a,g){if(a&&!_.isEqual(a,g)){if(b.onBeforeReload)b.onBeforeReload({$item:b});
b.renderCompleted=!0;b.search()}},!0);b.changeFindBy=function(a){b.filter=null;b.findBy=a.findBy;b.filter_title=450>=window.innerWidth?13>a.title.length?a.title:"..."+a.title.slice(-10):a.title;b.search()};b.location=f.url();b.reverse=!0;b.order=function(a,g){b.list=E("orderBy")(b.list,a,g)};b.selectionAll=!1;b.$watch("selectionAll",function(a,g){b.list&&b.list.forEach(function(b){b.sel=a})},!0);b.selectionAllChange=function(a){b.selectionAll=a};b.multiSelect=m.isMobile?!1:!0;b.toggleMultiSel=function(a,
g){a?a.forEach(function(a){a.sel=g}):(b.multiSelect=!b.multiSelect,b.selectionAll=!1)};b.isUnSelected=function(){if(!b.list)return!0;for(var a=0;a<b.list.length;a++){var g=b.list[a];if(g.sel&&1==g.sel)return!1}return!0};b.deleteAll=function(a){m.confirm("C\u00f3 ch\u1eafc ch\u1eafn xo\u00e1 t\u1ea5t c\u1ea3 d\u1eef li\u1ec7u c\u1ee7a ch\u1ee9c n\u0103ng n\u00e0y kh\u00f4ng?").then(function(g){1==g?l.deleteAll(id_app).then(function(a){b.list=[];b.selectedRow=null;m.toast("\u0110\u00e3 xo\u00e1 th\u00e0nh c\u00f4ng")},
function(b){b=b.data;b=_.isObject(b)?JSON.stringify(b):b;a?a(b):0<=b.indexOf("L\u1ed7i:")?m.alert(b):m.alert("Kh\u00f4ng th\u1ec3 x\u00f3a")}):a&&a("NOTACCEPTED")})};b.delete=function(a,g){a||_.find(b.list,function(a){return a.sel})?a?m.confirm("C\u00f3 ch\u1eafc ch\u1eafn xo\u00e1 kh\u00f4ng?").then(function(c){1==c?l.delete(id_app,a).then(function(g){b.list=_.reject(b.list,function(b){return b._id==a});b.selectedRow=null;m.toast("\u0110\u00e3 xo\u00e1 th\u00e0nh c\u00f4ng")},function(a){a=a.data;
a=_.isObject(a)?JSON.stringify(a):a;g?g(a):m.alert(a)}):g&&g("NOTACCEPTED")}):m.confirm("C\u00f3 ch\u1eafc ch\u1eafn xo\u00e1 nh\u1eefng d\u00f2ng \u0111\u00e3 ch\u1ecdn kh\u00f4ng").then(function(a){1==a&&async.map(b.list,function(a,g){if(a.sel&&1==a.sel){var c=a._id;l.delete(id_app,c).then(function(a){b.list=_.reject(b.list,function(a){return a._id==c});g(null,c)},function(a){g(a.data)})}else g()},function(a,g){a?(a=_.isObject(a)?JSON.stringify(a):a,0<=a.indexOf("L\u1ed7i:")?m.alert(a):m.alert("Kh\u00f4ng th\u1ec3 x\u00f3a")):
(b.selectedRow=null,m.toast("\u0110\u00e3 xo\u00e1 th\u00e0nh c\u00f4ng"),d.list=b.list)})}):(b.multiSelect=!0,m.toast("H\u00e3y ch\u1ecdn \u00edt nh\u1ea5t m\u1ed9t d\u00f2ng \u0111\u1ec3 xo\u00e1"))};k.initHomeController&&k.initHomeController(a,b,z,l,f,d);id_app&&m.nextTick(function(){u.load(id_app,{filter:{ma_cn:c.toUpperCase()}}).then(function(a){b.rpts=a.data},function(a){console.log(a.data)})});if(b.isListView&&b.onLoadView)b.onLoadView(b,m);b.export2excel=function(){var a=server_url_report+
"/api/"+id_app+"/"+t+"?type_data=xlsx&access_token="+m.token;m.toast("Ch\u01b0\u01a1ng tr\u00ecnh \u0111ang th\u1ef1c hi\u1ec7n. Anh(ch\u1ecb) h\u00e3y ch\u1edd \u0111\u1ee3i trong gi\u00e2y l\u00e1t.");m.downloadFile(a,v+".xlsx",function(a){a&&console.log("error export list to excel",a)})};b.rptManagementUrl="#!/rpt?ma_cn="+c.toUpperCase();b.rptManagement=function(){var a="rpt?ma_cn="+c.toUpperCase();m.openUrl(a)};b.printXlsx=function(a){if(!_online)return m.alert("Ch\u1ee9c n\u0103ng n\u00e0y y\u00eau c\u1ea7u k\u1ebft n\u1ed1i internet");
var g=[];b.list.forEach(function(a){a.sel&&g.push(a._id)});0<g.length?(a=server_url_report+"/api/"+id_app+"/"+c+"/excel/"+a+"?_id="+g.join(",")+"&access_token="+m.token,m.toast("Ch\u01b0\u01a1ng tr\u00ecnh \u0111ang th\u1ef1c hi\u1ec7n. Anh(ch\u1ecb) h\u00e3y ch\u1edd \u0111\u1ee3i trong gi\u00e2y l\u00e1t."),m.downloadFile(a,v+".xlsx",function(a){a&&console.log("error export to excel",a)})):(b.multiSelect=!0,m.toast("H\u00e3y ch\u1ecdn \u00edt nh\u1ea5t m\u1ed9t phi\u1ebfu"))};b.importhtml5=function(){if(!_online)return m.alert("Ch\u1ee9c n\u0103ng n\u00e0y y\u00eau c\u1ea7u k\u1ebft n\u1ed1i internet");
var a=b.search;w.open({templateUrl:"templates/sys/importhtml5.html",controller:["$scope","$rootScope","$controller","$http","$uibModalInstance","$window","appInfo",function(b,c,d,f,r,B,h){initLabel(c,b,h,"IMP",f);b.template=server_url_import+"/templates/imports/"+k.code+".xlsx";b.update=!0;b.action=server_url_import+"/api/"+id_app+"/"+k.server_path+"/import/excel";b.cancel=function(){r.close()};b.$on("$fileUploadSuccess",function(g,c){b.result=c;a()});b.$on("$fileUploadError",function(g,c){a();b.result=
c})}],size:h.modal_size||"sm",resolve:{parentScope:function(){return b}}})};b.import=function(){var a="#"+c+"/import?t=1";if(k.initImport)k.initImport(b,a,function(a,g){if(a)return m.alert(a);var c=0,d=p.open(g,"Import","directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=500,height=200");stop=C(function(){"OK"==d.document.title?(b.search(),C.cancel(stop),stop=void 0,d.close()):"ERROR"==d.document.title?(C.cancel(stop),stop=void 0):(c+=500,3E5<c&&
stop&&(C.cancel(stop),stop=void 0))},500)});else{var g=0,d=p.open(a,"Import","directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=500,height=200");stop=C(function(){"OK"==d.document.title?(b.search(),C.cancel(stop),stop=void 0,d.close()):"ERROR"==d.document.title?(C.cancel(stop),stop=void 0):(g+=500,3E5<g&&stop&&(C.cancel(stop),stop=void 0))},500)}};b.follow=function(a){1==a.follow_yn?G.delete(id_app,a.followObject._id).then(function(b){a.follow_yn=
0},function(a){a.data&&m.alert(a.data)}):(followObject={id_object:a._id,collection_name:c,id_app:id_app},G.create(id_app,followObject).then(function(b){a.followObject=b.data;a.follow_yn=1},function(a){a.data&&m.alert(a.data)}))};b.isLike=!1;id_app&&(z.get(server_url+"/api/"+id_app+"/like_module?q={module:'"+c+"',user_created:'"+B.email+"'}").then(function(a){(a=a.data)&&1==a.length&&(b.isLike=a[0].like)},function(a){console.log(a.data)}),b.like=function(){z.post(server_url+"/api/"+id_app+"/like_module",
{id_app:id_app,module:c,like:!0}).then(function(a){a.data&&(b.isLike=!0)},function(a){console.log(a.data)})},b.unlike=function(){z.post(server_url+"/api/"+id_app+"/like_module",{id_app:id_app,module:c,like:!1}).then(function(a){a.data&&(b.isLike=!1)},function(a){console.log(a.data)})});b.$on("keydown",function(a,g){116==g.which?b.search():g.ctrlKey&&77==g.which?b.add():g.ctrlKey&&68==g.which?b.delete():(g.ctrlKey&&65==g.which&&(b.multiSelect=!0,b.list&&b.list.forEach(function(a){a.sel=!0})),g.ctrlKey&&
85==g.which&&(b.multiSelect=!1,b.list&&b.list.forEach(function(a){a.sel=!1})))});b.chooseTemplate=function(a,g){I.chooseTemplate(c,a,g,b)};b.options=function(){var a="templates/"+k.group+"/"+c+"/templates/options.html";w.open({templateUrl:"templates/sys/options-"+k.group+".html",controller:["$scope","$controller","$http","$uibModalInstance","$window","$localStorage","options","parentScope","printFactory","$rootScope",function(b,d,f,h,D,m,r,N,p,l){b.code=c;b.group=k.group;b.path=a;var g={},A=id_app+
"_"+B.email+"_"+c+"_option";b.locals=m.getObject(A,{});b.locals||(b.locals={system:{}});b.locals.system||(b.locals.system={});b.options={check_so_ct:"0"};r.load(id_app,{filter:{id_func:c}}).then(function(a){a=a.data;1==a.length?(g=a[0],b.options=g.option,b.options.check_so_ct||(b.options.check_so_ct="0"),b.options.system||(b.options.system={}),b.options.system.width||(b.options.system.width=203)):(g.id_app=id_app,g.id_func=c)},function(a){console.log("error when load options",c,a.data)});b.changeWidthPage=
function(a){if(b.options&&b.options.system&&b.options.system.templateRpt){var c=$(b.options.system.templateRpt);"printView"===c.attr("id")?(c.removeAttr("style"),a&&(c.css("width",a+"mm"),c.css("margin","0px auto"))):c=a?$("<div id='printView' style='width: "+a+"mm; margin: 0px auto;'>"+b.options.system.templateRpt+"</div>"):$("<div id='printView'>"+b.options.system.templateRpt+"</div>");b.options.system.templateRpt=c[0].outerHTML}};b.save=function(){if(b.isSave)return l.alert("Ch\u01b0\u01a1ng tr\u00ecnh \u0111ang th\u1ef1c hi\u1ec7n");
b.isSave=!0;b.locals||(b.locals={});b.options&&b.options.system&&b.options.system.templateRpt&&(b.options.system.templateRpt=p.initTemplate(b.options.system.templateRpt,{details:[],tdttnos:[],tdttcos:[],vatvaos:[],vatras:[],ctcpmhs:[],ctcpbhs:[]},b.options.system)[0].outerHTML,b.locals.system.templateRpt=b.options.system.templateRpt);for(var a in b.locals)!b.options[a]&&b.locals[a]&&(b.options[a]=b.locals[a]);try{m.setObject(A,b.locals)}catch(P){}g.option=b.options;g._id?r.update(id_app,g._id,g).then(function(a){p.loadTemplate(c,
N);h.close();b.isSave=!1},function(a){l.toast(a.data+"<br/>Ch\u1ec9 nh\u1eefng t\u00f9y ch\u1ecdn theo ng\u01b0\u1eddi d\u00f9ng \u0111\u01b0\u1ee3c l\u01b0u.",null,null,null,"error");h.close();b.isSave=!1}):r.create(id_app,g).then(function(a){p.loadTemplate(c,N);h.close();b.isSave=!1},function(a){l.toast(a.data+"<br/>Ch\u1ec9 nh\u1eefng t\u00f9y ch\u1ecdn theo ng\u01b0\u1eddi d\u00f9ng \u0111\u01b0\u1ee3c l\u01b0u.",null,null,null,"error");h.close();b.isSave=!1})};b.cancel=function(){h.close();b.isSave=
!1}}],size:"sm",resolve:{parentScope:function(){return b}}})};F.add&&(delete F.add,b.add(F))}})}]);if(y=c)y=y.split("_").join(""),this.module.directive(y+"ListView",[function(){return{restrict:"E",scope:{onListItemClick:"&?",parameters:"=?",defaultValues:"=?",limit:"@",notLoadData:"=?",requireReload:"=?",onBeforeReload:"&?",onLoadView:"=?",selectedRow:"=?"},templateUrl:function(h,a){return"templates/"+k.group+"/"+c+"/templates/"+(a.templateUrl?a.templateUrl:"list")+".html"},controller:["$controller",
"$scope","$rootScope",function(h,a,b){a.isListView=!0;a.server_url=server_url;a.openUrl=b.openUrl;h(c+"HomeController",{$scope:a})}],link:function(c,a,b){}}}]),this.module.directive(y+"Form",[function(){return{restrict:"E",templateUrl:"templates/"+k.group+"/"+c+"/templates/form.html"}}]);this.quickview=function(h,a,b,k){if(_online){var l=_.filter(_.values(cmdmodules),function(a){return a.path.toLowerCase()===c});0<l.length&&!_.find(l,function(a){return a.command.visible})?h.open({templateUrl:"templates/sys/alert.html",
controller:["$scope","$uibModalInstance",function(a,b){a.msg="B\u1ea1n kh\u00f4ng c\u00f3 quy\u1ec1n s\u1eed d\u1ee5ng t\u00ednh n\u0103ng n\u00e0y.";a.dismiss=function(){b.close()}}],size:"sm"}):(k||(k={}),h.open({template:function(){return"<div  class='modal-header section-info'><button type='button' class='close' ng-click ='close()' aria-hidden='true'> &times;</button><h4 class='modal-title'>{{list_title}}</h4></div><div class='modal-body'><div style='height:{{innerHeight-70}}px'><"+c.split("_").join("")+
"-list-view "+(k.templateUrl?"template-url='"+k.templateUrl+"'":"")+" parameters ='parameters' "+(k.onListItemClick?"on-list-item-click='onListItemClick($item)' ":"")+(k.onLoadView?"on-load-view='onLoadView' ":"")+"></"+c.split("_").join("")+"-list-view></div></div>"},controller:["$rootScope","$scope","$controller","$uibModalInstance","appInfo","$http",function(f,d,h,p,l,A){initLabel(f,d,l,c,A);d.list_title=d.getLabel("ten_ct"+c,v).text;d.list_code=c;d.parameters=a;d.openUrl=f.openUrl;d.Ui=f.Ui;d.STP=
STP;k.onLoadView&&(d.onLoadView=function(a,b){k.onLoadView(a,b,p)});k.onListItemClick&&(d.onListItemClick=function(a){k.onListItemClick(a,p)});d.close=function(){b&&b();p.close()};d.$on("backbutton",function(a,b){d.close()})}],size:"md",backdrop:"static",resolve:{}}))}};this.module.controller(c+"ImportController",["$scope","$rootScope","$location","$routeParams",c+"Config","appInfo","$http",function(h,a,b,z,l,f,d){initLabel(a,h,f,c,d);f.info(c,function(c,d,f){c||(c=a.token,a.hide_nav=!0,h.action=
server_url+"/api/"+id_app+"/"+k.server_path+"/import/excel?access_token="+c,h.template="templates/templates/"+k.code+".xlsx",c=b.search(),c.values&&(h.action=h.action+"&values="+c.values),c.update&&(h.action=h.action+"&update="+c.update))})}]);this.module.controller(c+"AddController",["$controller","$scope","$http",c,"$location",c+"Config","$rootScope","$uibModal","$window","appInfo","$localStorage","options","$timeout","vPrint","$q",function(A,a,b,z,l,f,d,m,p,C,w,q,t,x,y){d.function_title=v;d.function_code=
c;initLabel(d,a,C,c,b);a.masterData={status:!0};a.data={status:!0,visible_to:0,exfields:{}};a.$uibModal=m;a.$http=b;a.$window=p;k.init&&k.init(a,A,{$http:b});a.action="M\u1edbi";C.info(c,function(C,u,v){if(!C){a.current_user=d.user;a.vPrint=x;angular.extend(a,f);async.parallel({opts:function(b){q.load(id_app,{filter:{id_func:c}}).then(function(f){f=f.data;if(1==f.length){f=f[0];a.ext_options={};for(var h in f.option)"system"!==h&&f.option[h]&&(a.ext_options[h]=f.option[h]);f=w.getObject(id_app+"_"+
d.user.email+"_"+c+"_option");for(h in f)"system"!==h&&f[h]&&(a.ext_options[h]=f[h])}b()},function(a){console.log("load options",a.data);b()})}},function(c,D){d.app_info&&d.app_info.options&&(a.f_sl=d.app_info.options.f_sl||2,a.f_ty_gia=d.app_info.options.f_ty_gia||0,a.f_gia=d.app_info.options.f_gia||0,a.f_tien=d.app_info.options.f_tien||0,1==a.data.ty_gia?(a.f_gia_nt=d.app_info.options.f_gia||0,a.f_tien_nt=d.app_info.options.f_tien||0):(a.f_gia_nt=d.app_info.options.f_gia_nt||2,a.f_tien_nt=d.app_info.options.f_tien_nt||
2),a.round=a.f_tien_nt,a.$watch("data.ty_gia",function(b,c){1==a.data.ty_gia?(a.f_gia_nt=d.app_info.options.f_gia||0,a.f_tien_nt=d.app_info.options.f_tien||0):(a.f_gia_nt=d.app_info.options.f_gia_nt||2,a.f_tien_nt=d.app_info.options.f_tien_nt||2);a.round=a.f_tien_nt}));a.data.options=a.ext_options;a.masterData.options=a.ext_options;_.extend(a.data,a.ext_options);_.extend(a.masterData,a.ext_options);k.defaultValues&&(c=JSON.parse(JSON.stringify(k.defaultValues)),_.extend(a.data,c),_.extend(a.masterData,
c));if(c=l.search())_.extend(a.data,c),_.extend(a.masterData,c);h.onAdd&&d.nextTick(function(){h.onAdd(a,{$controller:A,$rootScope:d,$http:b,service:z,$location:l,config:f,$window:p,$uibModal:m})});if(h.onInput)h.onInput(a,{$controller:A,$rootScope:d,$http:b,service:z,$location:l,config:f,$window:p,$uibModal:m,$q:y,app_info:d.app_info||{options:{}}});t(function(){a.isDataLoaded=!0},100)});a.reset=function(){a.data=angular.copy(a.masterData)};a.cancel=function(){var a=l.search().redirect;a?"back"==
a?p.history.back():l.url(a):p.history.back()};a.isUnchanged=function(){return angular.equals(a.data,a.masterData)};var E=function(b,c){if(a.isSave)return d.alert("Ch\u01b0\u01a1ng tr\u00ecnh \u0111ang th\u1ef1c hi\u1ec7n");a.isSave=!0;a.$emit("$dataSaveStart");z.create(id_app,a.data).then(function(k){var B=k.data;a.masterData=B;_.extend(a.data,B);f.list||(f.list=[]);f.list.push(a.masterData);(k=l.search().redirect)?"back"==k?p.history.back():l.url(k):h.has_view?l.url("/"+a.path+"/view/"+B._id):l.path("/"+
a.path);a.$emit("$dataSaveSuccess");if(h.onSaved)h.onSaved(a,B,{$rootScope:d});if(a.printRpt&&b)if(h.onPrint)h.onPrint(a,function(){a.printRpt("",B)});else a.printRpt("",B);a.isSave=!1;c&&c(B)},function(b){a.isSave=!1;b=b.data;a.$emit("$dataSaveError");0>b.indexOf("L\u1ed7i")&&(0<=b.indexOf("duplicate")?b="L\u1ed7i: \u0110\u00e3 t\u1ed3n t\u1ea1i":0<=b.indexOf("Not allowed")&&(b="L\u1ed7i: B\u1ea1n kh\u00f4ng c\u00f3 quy\u1ec1n th\u1ef1c hi\u1ec7n thao t\u00e1c n\u00e0y"));angular.isArray(b)?d.alert(b.join("\n")):
(b||(b="Kh\u00f4ng th\u1ec3 k\u1ebft n\u1ed1i v\u1edbi m\u00e1y ch\u1ee7. H\u00e3y th\u1eed l\u1ea1i."),d.alert(b))})};a.create=function(c,k){if(h.onSave)h.onSave(a,a.data,{action:"CREATE",$controller:A,$rootScope:d,$http:b,service:z,$location:l,config:f,$window:p,$uibModal:m},function(a,b){if(a)return d.alert(a);b&&E(c,k)});else E(c,k)};a.$on("keydown",function(b,c){c.ctrlKey&&83==c.which&&a.create()});k.initAddController&&k.initAddController(A,a,b,z,l,f)}})}]);this.quickadd=function(A,a,b,z){var l=
_.filter(_.values(cmdmodules),function(a){return a.path.toLowerCase()===c});0<l.length&&!_.find(l,function(a){return a.command.visible})?A.open({templateUrl:"templates/sys/alert.html",controller:["$scope","$uibModalInstance",function(a,b){a.msg="B\u1ea1n kh\u00f4ng c\u00f3 quy\u1ec1n s\u1eed d\u1ee5ng t\u00ednh n\u0103ng n\u00e0y.";a.dismiss=function(){b.close()}}],size:"sm"}):A.open({templateUrl:"templates/"+k.group+"/"+c+"/templates/dialog-quickadd.html",controller:["$scope","$controller","$http",
c,"$location",c+"Config","$uibModalInstance","$window","$rootScope","appInfo","$localStorage","options","$timeout","vPrint","$q",function(f,d,m,p,l,w,q,v,x,t,y,u,I,M,F){initLabel(x,f,t,c,m);f.$uibModal=A;f.$http=m;f.$window=v;f.action="M\u1edbi";f.Ui=x.Ui;f.STP=STP;f.vPrint=M;var D=function(){var a,B;f.data&&(a=f.data.ma_dvcs,B=f.data.ma_kho);f.masterData={status:!0};f.data={status:!0,visible_to:0,exfields:{}};async.parallel({opts:function(a){f.ext_options?a():u.load(id_app,{filter:{id_func:c}}).then(function(b){b=
b.data;if(1==b.length){b=b[0];f.ext_options={};for(var d in b.option)"system"!==d&&b.option[d]&&(f.ext_options[d]=b.option[d]);b=y.getObject(id_app+"_"+x.user.email+"_"+c+"_option");for(d in b)"system"!==d&&b[d]&&(f.ext_options[d]=b[d])}a()},function(b){console.log(b.data);a()})}},function(){f.data.options=f.ext_options;f.masterData.options=f.ext_options;_.extend(f.masterData,f.ext_options);_.extend(f.data,f.ext_options);a&&!f.data.ma_dvcs&&(f.data.ma_dvcs=a);B&&!f.data.ma_kho&&(f.data.ma_kho=B);
if(k.defaultValues){var c=JSON.parse(JSON.stringify(k.defaultValues));_.extend(f.data,c)}if(b)for(var g in b)f.data[g]=b[g];for(var D in f.ext_options)f.data.details&&f.data.details.forEach(function(a){a[D]||(a[D]=f.ext_options[D])});if(c=l.search())_.extend(f.data,c),_.extend(f.masterData,c);angular.extend(f,w);x.app_info&&x.app_info.options&&(f.f_sl=x.app_info.options.f_sl||2,f.f_ty_gia=x.app_info.options.f_ty_gia||0,f.f_gia=x.app_info.options.f_gia||0,f.f_tien=x.app_info.options.f_tien||0,1==f.data.ty_gia?
(f.f_gia_nt=x.app_info.options.f_gia||0,f.f_tien_nt=x.app_info.options.f_tien||0):(f.f_gia_nt=x.app_info.options.f_gia_nt||2,f.f_tien_nt=x.app_info.options.f_tien_nt||2),f.round=f.f_tien_nt,f.$watch("data.ty_gia",function(a,b){1==f.data.ty_gia?(f.f_gia_nt=x.app_info.options.f_gia||0,f.f_tien_nt=x.app_info.options.f_tien||0):(f.f_gia_nt=x.app_info.options.f_gia_nt||2,f.f_tien_nt=x.app_info.options.f_tien_nt||2);f.round=f.f_tien_nt}));k.init&&k.init(f,d,{$http:m});k.initAddController&&k.initAddController(d,
f,m,p,l,w);h.onAdd&&x.nextTick(function(){h.onAdd(f,{$controller:d,$rootScope:x,$http:m,service:p,$location:l,config:w,$window:v,$uibModal:A})});if(h.onInput)h.onInput(f,{$controller:d,$rootScope:x,$http:m,service:p,$location:l,config:w,$window:v,$uibModal:A,$q:F,app_info:x.app_info||{options:{}}});I(function(){f.isDataLoaded=!0},100)})};f.isUnchanged=function(){return angular.equals(f.data,f.masterData)};var B=function(b,c,d){if(f.isSave)return x.alert("Ch\u01b0\u01a1ng tr\u00ecnh \u0111ang th\u1ef1c hi\u1ec7n");
f.isSave=!0;f.$emit("$dataSaveStart");p.create(id_app,f.data).then(function(g){var k=g.data;f.masterData=k;_.extend(f.data,k);w.list||(w.list=[]);w.list.push(f.masterData);a&&a(f.masterData);c&&c(k);f.isSave=!1;f.$emit("$dataSaveSuccess");if(h.onSaved)h.onSaved(f,k,{$rootScope:x});if(f.printRpt&&b)if(h.onPrint)h.onPrint(f,function(){f.printRpt("",k);d&&d.newAfterSave?D():q.close()});else f.printRpt("",k),d&&d.newAfterSave?D():q.close();else d&&d.newAfterSave?D():q.close()},function(a){f.isSave=!1;
a=a.data;f.$emit("$dataSaveError");0>a.indexOf("L\u1ed7i")&&(0<=a.indexOf("duplicate")?a="L\u1ed7i: \u0110\u00e3 t\u1ed3n t\u1ea1i":0<=a.indexOf("Not allowed")&&(a="L\u1ed7i: B\u1ea1n kh\u00f4ng c\u00f3 quy\u1ec1n th\u1ef1c hi\u1ec7n thao t\u00e1c n\u00e0y"));angular.isArray(a)?x.alert(a.join("\n")):(a||(a="Kh\u00f4ng th\u1ec3 k\u1ebft n\u1ed1i v\u1edbi m\u00e1y ch\u1ee7. H\u00e3y th\u1eed l\u1ea1i."),x.alert(a))})};f.create=function(a,b,c){if(h.onSave)h.onSave(f,f.data,{action:"CREATE",$controller:d,
$rootScope:x,$http:m,service:p,$location:l,config:w,$window:v,$uibModal:A},function(d,f){if(d)return x.alert(d);f&&B(a,b,c)},c);else B(a,b,c)};f.createAndAdd=function(a,b){f.create(a,b,{newAfterSave:!0})};f.cancel=function(){q.close();z&&z()};D();f.$on("backbutton",function(a,b){f.cancel()})}],size:h.modal_size||"sm",backdrop:"static",resolve:{}})};this.quickupdate=function(c,a,b){c.update(id_app,a._id,a).then(function(a){b(null,a.data)},function(a){b(a.data)})};this.quickedit=function(A,a,b,z){var l=
_.filter(_.values(cmdmodules),function(a){return a.path.toLowerCase()===c});if(0<l.length&&!_.find(l,function(a){return a.command.visible}))A.open({templateUrl:"templates/sys/alert.html",controller:["$scope","$uibModalInstance",function(a,b){a.msg="B\u1ea1n kh\u00f4ng c\u00f3 quy\u1ec1n s\u1eed d\u1ee5ng t\u00ednh n\u0103ng n\u00e0y.";a.dismiss=function(){b.close()}}],size:"sm"});else{var f;_.isObject(a)||(a={_id:a});f=a._id;A.open({templateUrl:"templates/"+k.group+"/"+c+"/templates/dialog-quickadd.html",
controller:["$scope","$controller","$http",c,"$location",c+"Config","$uibModalInstance","$window","$routeParams","$timeout","$rootScope","appInfo","options","vPrint","$q",function(d,m,l,q,w,v,t,x,y,G,u,I,M,F,D){initLabel(u,d,I,c,l);d.data=a;d._data=a;d.Ui=u.Ui;d.STP=STP;d.vPrint=F;k.init&&k.init(d,m,{$http:l});u.nextTick(function(){q.get(id_app,f).then(function(a){if(a=a.data){d.masterData=a;_.extend(d.data,a);d.$uibModal=A;d.$http=l;d.$window=x;d.action="S\u1eeda";M.load(id_app,{filter:{id_func:c}}).then(function(a){a=
a.data;if(1==a.length){a=a[0];d.ext_options={};for(var b in a.option)a.option[b]&&(d.ext_options[b]=a.option[b]);d.data.options=d.ext_options;d.masterData.options=d.ext_options}});k.loadItem&&k.loadItem(d,d.data);G(function(){d.isDataLoaded=!0},100);angular.extend(d,v);u.app_info&&u.app_info.options&&(d.f_sl=u.app_info.options.f_sl||2,d.f_ty_gia=u.app_info.options.f_ty_gia||0,d.f_gia=u.app_info.options.f_gia||0,d.f_tien=u.app_info.options.f_tien||0,1==d.data.ty_gia?(d.f_gia_nt=u.app_info.options.f_gia||
0,d.f_tien_nt=u.app_info.options.f_tien||0):(d.f_gia_nt=u.app_info.options.f_gia_nt||2,d.f_tien_nt=u.app_info.options.f_tien_nt||2),d.round=d.f_tien_nt,d.$watch("data.ty_gia",function(a,b){1==d.data.ty_gia?(d.f_gia_nt=u.app_info.options.f_gia||0,d.f_tien_nt=u.app_info.options.f_tien||0):(d.f_gia_nt=u.app_info.options.f_gia_nt||2,d.f_tien_nt=u.app_info.options.f_tien_nt||2);d.round=d.f_tien_nt}));d.isUnchanged=function(){return angular.equals(d.data,d.masterData)};h.onEdit&&u.nextTick(function(){h.onEdit(d,
{$controller:m,$rootScope:u,$http:l,service:q,$location:w,config:v,$window:x,$uibModal:A})});if(h.onInput)h.onInput(d,{$controller:m,$rootScope:u,$http:l,service:q,$location:w,config:v,$window:x,$uibModal:A,$q:D,app_info:u.app_info||{options:{}}});var B=function(a,c){if(d.isSave)return u.alert("Ch\u01b0\u01a1ng tr\u00ecnh \u0111ang th\u1ef1c hi\u1ec7n");d.isSave=!0;d.$emit("$dataSaveStart");q.update(id_app,f,d.data).then(function(f){var g=f.data,k;for(k in g)d.masterData[k]=g[k];_.extend(d.data,g);
b&&b(d.masterData);t.close();d.$emit("$dataSaveSuccess");if(h.onSaved)h.onSaved(d,g,{$rootScope:u});if(d.printRpt&&a)if(h.onPrint)h.onPrint(d,function(){d.printRpt("",g)});else d.printRpt("",g);d.isSave=!1;c&&c(g)},function(a){d.isSave=!1;a=a.data;d.$emit("$dataSaveError");a=JSON.stringify(a);if(0>a.indexOf("L\u1ed7i")){if(0<=a.indexOf("duplicate"))return u.alert("L\u1ed7i: \u0110\u00e3 t\u1ed3n t\u1ea1i");if(0<=a.indexOf("Not allowed"))return u.alert("L\u1ed7i: B\u1ea1n kh\u00f4ng c\u00f3 quy\u1ec1n th\u1ef1c hi\u1ec7n thao t\u00e1c n\u00e0y")}a=
JSON.parse(a);angular.isArray(a)?u.alert(a.join("\n")):(a||(a="L\u1ed7i: Kh\u00f4ng th\u1ec3 k\u1ebft n\u1ed1i v\u1edbi m\u00e1y ch\u1ee7. H\u00e3y th\u1eed l\u1ea1i."),u.alert(a))})};d.create=function(a,b){if(h.onSave)h.onSave(d,d.data,{action:"UPDATE",$controller:m,$rootScope:u,$http:l,service:q,$location:w,config:v,$window:x,$uibModal:A},function(c,d){if(c)return u.alert(c);d&&B(a,b)});else B(a,b)};d.delete=function(a){u.confirm("C\u00f3 ch\u1eafc ch\u1eafn xo\u00e1 kh\u00f4ng?").then(function(c){1==
c&&q.delete(id_app,a._id).then(function(a){var c=a.data;v.list=_.reject(v.list,function(a){return a._id==c._id});z&&z(c);b&&b(c,"delete");t.close();d.$emit("$dataSaveSuccess")},function(a){d.$emit("$dataSaveError");a=a.data;a=_.isObject(a)?JSON.stringify(a):a;0<=a.indexOf("L\u1ed7i:")?u.alert(a):u.alert("Kh\u00f4ng th\u1ec3 x\u00f3a")})})};d.cancel=function(){t.close()};d.$on("backbutton",function(a,b){d.cancel()});k.initEditController&&k.initEditController(m,d,l,q,w,y,v,G)}else u.alert("\u0110\u1ed1i t\u01b0\u1ee3ng n\u00e0y kh\u00f4ng t\u1ed3n t\u1ea1i\nid:"+
f),t.close()},function(a){a=a.data;0<=a.indexOf("L\u1ed7i")?u.alert(a):u.alert(a||"Kh\u00f4ng th\u1ec3 t\u00ecm th\u1ea5y \u0111\u1ed1i t\u01b0\u1ee3ng n\u00e0y");t.close()})})}],size:h.modal_size||"sm",backdrop:"static",resolve:{}})}};this.module.controller(c+"EditController",["$controller","$scope","$http",c,"$location","$routeParams",c+"Config","$timeout","$rootScope","$uibModal","$window","appInfo","options","vPrint","$q",function(q,a,b,z,l,f,d,m,p,t,w,y,H,x,J){p.function_title=v;p.function_code=
c;initLabel(p,a,y,c,b);a.masterData=null;a.data={};a.$uibModal=t;a.$http=b;a.$window=w;a.action="S\u1eeda";angular.extend(a,d);k.init&&k.init(a,q,{$http:b});y.info(c,function(v,u,A){if(!v){a.current_user=p.user;a.vPrint=x;d.list&&(a.masterData=_.find(d.list,function(a){return a._id==f.id}));a.openProfile=function(a){viewProfile(t,a)};a.masterData?(a.data=angular.copy(a.masterData),k.loadItem&&k.loadItem(a,a.data),h.onEdit&&p.nextTick(function(){h.onEdit(a,{$controller:q,$http:b,service:z,$location:l,
config:d,$window:w,$uibModal:t})}),m(function(){a.isDataLoaded=!0},100)):(a.masterData={},p.nextTick(function(){a.$emit("$dataChangeStart");z.get(id_app,f.id).then(function(f){a.masterData=f.data;a.data=angular.copy(a.masterData);d.list||(d.list=[]);d.list.push(a.masterData);H.load(id_app,{filter:{id_func:c}}).then(function(b){b=b.data;if(1==b.length){b=b[0];a.ext_options={};for(var c in b.option)b.option[c]&&(a.ext_options[c]=b.option[c]);a.data.options=a.ext_options;a.masterData.options=a.ext_options}},
function(a){console.log(a.data)});k.loadItem&&k.loadItem(a,a.data);p.app_info&&p.app_info.options&&(a.f_sl=p.app_info.options.f_sl||2,a.f_ty_gia=p.app_info.options.f_ty_gia||0,a.f_gia=p.app_info.options.f_gia||0,a.f_tien=p.app_info.options.f_tien||0,1==a.data.ty_gia?(a.f_gia_nt=p.app_info.options.f_gia||0,a.f_tien_nt=p.app_info.options.f_tien||0):(a.f_gia_nt=p.app_info.options.f_gia_nt||2,a.f_tien_nt=p.app_info.options.f_tien_nt||2),a.round=a.f_tien_nt,a.$watch("data.ty_gia",function(b,c){1==a.data.ty_gia?
(a.f_gia_nt=p.app_info.options.f_gia||0,a.f_tien_nt=p.app_info.options.f_tien||0):(a.f_gia_nt=p.app_info.options.f_gia_nt||2,a.f_tien_nt=p.app_info.options.f_tien_nt||2);a.round=a.f_tien_nt}));h.onEdit&&p.nextTick(function(){h.onEdit(a,{$controller:q,$rootScope:p,$http:b,service:z,$location:l,config:d,$window:w,$uibModal:t})});if(h.onInput)h.onInput(a,{$controller:q,$rootScope:p,$http:b,service:z,$location:l,config:d,$window:w,$uibModal:t,$q:J,app_info:p.app_info||{options:{}}});m(function(){a.isDataLoaded=
!0;a.$emit("$dataChangeSuccess")},100)},function(b){b=b.data;a.$emit("$dataChangeError");0<=b.indexOf("L\u1ed7i")?p.alert(b):p.alert(b||"Kh\u00f4ng th\u1ec3 t\u00ecm th\u1ea5y \u0111\u1ed1i t\u01b0\u1ee3ng n\u00e0y")})}));a.isUnchanged=function(){return angular.equals(a.data,a.masterData)};a.reset=function(){a.data=angular.copy(a.masterData)};a.cancel=function(){var b=l.search().redirect;b?"back"==b?w.history.back():l.url(b):h.has_view?l.url("/"+a.path+"/view/"+a.data._id):w.history.back()};a.$on("keydown",
function(b,c){c.ctrlKey&&83==c.which&&a.create()});var y=function(b,c){if(a.isSave)return p.alert("Ch\u01b0\u01a1ng tr\u00ecnh \u0111ang th\u1ef1c hi\u1ec7n");a.isSave=!0;a.$emit("$dataSaveStart");z.update(id_app,f.id,a.data).then(function(d){var f=d.data,k;for(k in f)a.masterData[k]=f[k];_.extend(a.data,f);(d=l.search().redirect)?"back"==d?w.history.back():l.url(d):h.has_view?l.url("/"+a.path+"/view/"+f._id):l.path("/"+a.path);a.$emit("$dataSaveSuccess");if(h.onSaved)h.onSaved(a,f,{$rootScope:p});
if(a.printRpt&&b)if(h.onPrint)h.onPrint(a,function(){a.printRpt("",f)});else a.printRpt("",f);a.isSave=!1;c&&c(f)},function(b){a.isSave=!1;b=b.data;a.$emit("$dataSaveError");b=JSON.stringify(b);if(0>b.indexOf("L\u1ed7i")){if(0<=b.indexOf("duplicate"))return p.alert("L\u1ed7i: \u0110\u00e3 t\u1ed3n t\u1ea1i");if(0<=b.indexOf("Not allowed"))return p.alert("L\u1ed7i: B\u1ea1n kh\u00f4ng c\u00f3 quy\u1ec1n th\u1ef1c hi\u1ec7n thao t\u00e1c n\u00e0y")}b=JSON.parse(b);angular.isArray(b)?p.alert(b.join("\n")):
(b||(b="Kh\u00f4ng th\u1ec3 k\u1ebft n\u1ed1i v\u1edbi m\u00e1y ch\u1ee7. H\u00e3y th\u1eed l\u1ea1i."),p.alert(b))})};a.create=function(c,f){if(h.onSave)h.onSave(a,a.data,{action:"UPDATE",$controller:q,$rootScope:p,$http:b,service:z,$location:l,config:d,$window:w,$uibModal:t},function(a,b){if(a)return p.alert(a);b&&y(c,f)});else y(c,f)};k.initEditController&&k.initEditController(q,a,b,z,l,f,d,m)}})}]);this.module.controller(c+"ViewController",["$controller","$scope","$routeParams",c+"Config",c,"$rootScope",
"$location","$window","$http","$uibModal","appInfo","$localStorage","$interval","follow","link","$timeout",function(q,a,b,t,l,f,d,m,p,y,w,E,H,x,J,G){f.function_title=v;f.function_code=c;a.Ui=f.Ui;a.STP=STP;initLabel(f,a,w,c,p);w.info(c,function(u,v,w){if(!u){a.code=c;a.location=d.url();a.current_user=f.user;a.action="Xem";a.current_record=0;a.total_records=0;angular.extend(a,t);var A=function(){f.nextTick(function(){a.$emit("$dataChangeStart");l.get(id_app,a._id||b.id).then(function(b){var c=b.data;
a.data=c;a.data.links=[];id_app&&x.load(id_app,{filter:{id_object:c._id,user_created:a.current_user.email}}).then(function(a){(a=a.data)&&0<a.length?(c.followObject=a[0],c.follow_yn=1):c.follow_yn=0},function(a){c.follow_yn=0});if(h.onView)h.onView(a,{$controller:q,$http:p,service:l,$location:d,config:t,$window:m,$uibModal:y,$rootScope:f,$localStorage:E,$interval:H,$timeout:G});a.$emit("$dataChangeSuccess")},function(b){console.log("error",b);b.data&&f.alert(b.data);a.$emit("$dataChangeError");d.url("/"+
a.path)})})};if(a.list)for(u=0;u<a.list.length;u++)if(a.list[u]._id==(a._id||b.id)){a.current_record=u;a.total_records=a.list.length-1;a.data=a.list[a.current_record];a.data.links=[];if(h.onView)h.onView(a,{$controller:q,$http:p,service:l,$location:d,config:t,$window:m,$uibModal:y,$rootScope:f,$localStorage:E,$interval:H,$timeout:G});break}a.data||A();a.back=function(){var b=d.search().redirect;b?"back"==b?m.history.back():d.url(b):d.url("/"+a.path)};a.update=function(b,c){var d={};_.extend(d,a.data);
b&&_.extend(d,b);l.update(id_app,a.data._id,d).then(function(b){b=b.data;if(a.onUpdated)a.onUpdated(b);_.extend(a.data,b);c&&(_.isFunction(c)?c(null,b):f.alert(c))},function(a){c&&_.isFunction(c)?c(a.data):a.data&&f.alert(a.data)})};a.edit=function(){k.quickedit(y,a._id||b.id,function(b){_.extend(a.data,b)},function(){a.back()})};a.add=function(){k.quickadd(y,function(a){d.url("/"+c+"/view/"+a._id)},k.defaultvalues)};a.backRecord=function(){0<a.current_record&&(--a.current_record,d.path(c+"/view/"+
a.list[a.current_record]._id))};a.nextRecord=function(){a.list&&a.current_record<a.total_records&&(a.current_record+=1,d.path(c+"/view/"+a.list[a.current_record]._id))};a.delete=function(b){f.confirm("C\u00f3 ch\u1eafc ch\u1eafn xo\u00e1 kh\u00f4ng?").then(function(c){1==c&&l.delete(id_app,b).then(function(c){c=c.data;t.list=_.reject(t.list,function(a){return a._id==b});if(a.onDeleted)a.onDeleted(c);else(c=d.search().redirect)?"back"==c?m.history.back():d.url(c):d.url("/"+a.path)},function(a){a=a.data;
a=_.isObject(a)?JSON.stringify(a):a;0<=a.indexOf("L\u1ed7i:")?f.alert(a):f.alert("Kh\u00f4ng th\u1ec3 x\u00f3a")})})};a.openProfile=function(a){viewProfile(y,a)};a.follow=function(){1==a.data.follow_yn?x.delete(id_app,a.data.followObject._id).then(function(b){a.data.follow_yn=0},function(a){a.data&&f.alert(a.data)}):(followObject={id_object:a.data._id,collection_name:c,id_app:id_app},x.create(id_app,followObject).then(function(b){a.data.followObject=b.data;a.data.follow_yn=1},function(a){a.data&&
f.alert(a.data)}))};a.$on("keydown",function(b,c){116==c.which?A():c.ctrlKey&&(69==c.which?a.edit():77==c.which&&a.add())});a.$on("backbutton",function(b,c){a.back()});a.addLink=function(b,d){var f={};f.id_a=a.data._id;f.collection_a=c;f.collection_b=b.collection_name;f.id_b=b._id;J.create(id_app,f).then(function(c){_.extend(f,c.data);f.obj=b;f.collection_obj=b.collection_name;f.title=b[d];a.data.links.push(f)},function(c){console.log(c.data);J.load(id_app,{filter:{id_a:f.id_a,id_b:f.id_b}}).then(function(c){c=
c.data;0<c.length&&(_.extend(f,c[0]),f.obj=b,f.collection_obj=b.collection_name,f.title=b[d],a.data.links.push(f))})})}}})}]);this.module.directive(k.code+"DetailView",function(){return{restrict:"E",scope:{onDeleted:"=?",onExpand:"&?",onCloseSlide:"&?",onUpdated:"=?"},templateUrl:function(c,a){return"templates/"+k.group+"/"+k.code+"/templates/"+(a.templateUrl?a.templateUrl:"view")+".html"},controller:k.code+"ViewController",link:function(c,a,b){c._id=b.code;c.innerHeight=window.innerHeight-80}}});
this.quickdetailview=function(h,a,b,k){var l;_.isObject(a)||(a={_id:a});l=a._id;h.open({template:function(){return getTemplate(c,"<"+c+'-detail-view on-deleted ="itemDeleted" on-updated ="itemUpdated" code="'+l+'"></'+c+"-detail-view>")},controller:["$scope","$uibModalInstance",function(a,c){a.itemDeleted=function(a){k&&k(a);c.close("deleted")};a.itemUpdated=function(a){b&&b(a)};a.close=function(){c.close()};a.title=v;a.innerHeight=window.innerHeight-10}],size:"md",backdrop:"static"})};this.module.config(["$routeProvider",
"$locationProvider",function(c,a){c.when("/"+k.code,{templateUrl:"templates/"+k.group+"/"+k.code+"/templates/list.html",controller:k.code+"HomeController"}).when("/"+k.code+"/add",{templateUrl:"templates/"+k.group+"/"+k.code+"/templates/edit.html",controller:k.code+"AddController"}).when("/"+k.code+"/json",{templateUrl:"templates/sys/json.html",controller:k.code+"JsonController"}).when("/"+k.code+"/import",{templateUrl:"templates/sys/import.html",controller:k.code+"ImportController"}).when("/"+k.code+
"/edit/:id",{templateUrl:"templates/"+k.group+"/"+k.code+"/templates/edit.html",controller:k.code+"EditController"}).when("/"+k.code+"/view/:id",{templateUrl:"templates/"+k.group+"/"+k.code+"/templates/view.html",controller:k.code+"ViewController"})}]);this.initModule&&this.initModule(this.module)};
