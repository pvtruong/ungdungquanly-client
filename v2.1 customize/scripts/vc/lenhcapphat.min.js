var $jscomp={scope:{},findInternal:function(a,c,b){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(c.call(b,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,c,b,d){if(c){b=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in b||(b[e]={});b=b[e]}a=a[a.length-1];d=b[a];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");
var lenhcapphatModule=new baseVoucher("lenhcapphat","lenhcapphat",[],"L\u1ec7nh c\u1ea5p ph\u00e1t v\u1eadt t\u01b0",{onLoading:function(a,c){a.createPXK=function(b){var a=JSON.parse(JSON.stringify(b));a.id_lenhcapphat=a._id;a.details.forEach(function(b){b.sl_xuat=b.so_luong-b.sl_da_xuat;b.gia_von_nt=b.gia_nt||0;b.gia_von=b.gia||0;b.tien_xuat_nt=STP.round((b.tien_nt||0)*b.sl_xuat,0);b.tien_xuat=b.tien_xuat_nt});delete a._id;delete a.so_ct;delete a.trang_thai;delete a.ngay_ct;pxkModule.quickadd(c.$uibModal,
function(a){c.service.get(id_app,b._id).then(function(a){_.extend(b,a.data)})},a)}},onInput:function(a,c){a.tinh=function(){c.$rootScope.alert("Ch\u01b0\u01a1ng tr\u00ecnh \u0111\u00e3 th\u1ef1c hi\u1ec7n xong")}},onSave:function(a,c,b,d){for(c=0;c<a.data.details.length;c++)if(a.data.details[c].ton_kho<a.data.details[c].so_luong)return d("V\u1eadt t\u01b0 "+a.data.details[c].ten_vt+" kh\u00f4ng \u0111\u1ee7 \u0111\u1ec3 th\u1ef1c hi\u1ec7n l\u1ec7nh c\u1ea5p ph\u00e1t");d(null,a.data)}});
lenhcapphatModule.defaultValues={};lenhcapphatModule.defaultValues4Detail={so_luong:0};lenhcapphatModule.defaultCondition4Search={tu_ngay:new Date,den_ngay:new Date,so_ct:"",dien_giai:""};
lenhcapphatModule.watchDetail=function(a,c){a.getInvoice=function(){c.$uibModal.open({templateUrl:"templates/vouchers/lenhcapphat/templates/form-select-invoice.html",controller:["$scope","$uibModalInstance","parentScope","$filter","$rootScope",function(b,a,c,f,g){b.STP=STP;b.condition={tu_ngay:new Date(moment().format("YYYY-MM-01")),den_ngay:new Date};b.ngData=c.ngData;b.dt_current=c.dt_current;b.ngMasterData=c.ngMasterData;b.condition.id_contract=b.ngMasterData.id_contract;b.condition.so_ct_contract=
b.ngMasterData.so_ct_contract;b.condition.id_lenhsx=b.ngMasterData.id_lenhsx;b.condition.so_ct_lenhsx=b.ngMasterData.so_ct_lenhsx;b.masters=[];b.details=[];b.selectAllDetail=function(b,a){b.details.forEach(function(a){a.sel=b.sel})};b.invoiceClick=function(a){b.details=[];var c=_.find(b.masters,function(b){return b._id==a});b.details=c.details};b.loadInvoice=function(){b.masters=[];b.details=[];var a=server_url_report+"/api/"+id_app+"/getkehoachmh4lenhcp?t=1";b.condition.id_lenhsx&&(a=a+"&id_lenhsx="+
b.condition.id_lenhsx);b.ngMasterData._id&&(a=a+"&id_ct="+b.ngMasterData._id);a=a+"&tu_ngay="+f("date")(b.condition.tu_ngay,"yyyy-MM-dd");a=a+"&den_ngay="+f("date")(b.condition.den_ngay,"yyyy-MM-dd");b.condition.so_ct&&(a=a+"&so_ct="+b.condition.so_ct);b.condition.id_contract&&(a=a+"&id_contract="+b.condition.id_contract);scope.$http.get(a).then(function(a){b.masters=a.data},function(a){b.masters=[];a.data&&g.alert(a.data)})};b.ok=function(){b.condition.id_lenhsx&&(c.ngMasterData.id_lenhsx=b.condition.id_lenhsx,
c.ngMasterData.so_ct_lenhsx=b.condition.so_ct_lenhsx);b.condition.id_contract&&(c.ngMasterData.id_contract=b.condition.id_contract,c.ngMasterData.so_ct_contract=b.condition.so_ct_contract);c.ngMasterData.details=[];var d=0;b.masters.forEach(function(a){a.sel&&a.details.forEach(function(a){a.sel&&(a.line=d,c.ngMasterData.details.push(a),d++)})});a.close()};b.cancel=function(){a.close()}}],size:"lg",resolve:{parentScope:function(){return a}}})}};
lenhcapphatModule.prepareCondition4Search=function(a,c){return{so_ct:{$regex:a.vcondition.so_ct,$options:"i"},dien_giai:{$regex:a.vcondition.dien_giai,$options:"i"},ngay_ct:{$gte:dateTime2Date(a.vcondition.tu_ngay),$lte:dateTime2Date(a.vcondition.den_ngay)}}};
