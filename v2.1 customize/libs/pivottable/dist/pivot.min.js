(function(){var J=[].indexOf||function(d){for(var t=0,J=this.length;t<J;t++)if(t in this&&this[t]===d)return t;return-1},ha=[].slice,F=function(d,t){return function(){return d.apply(t,arguments)}},t={}.hasOwnProperty;(function(d){return"object"===typeof exports&&"object"===typeof module?d(require("jquery")):"function"===typeof define&&define.amd?define(["jquery"],d):d(jQuery)})(function(d){var S,da,w,K,ea,T,A,fa,G,B,L,C,M,N,Q,y,D,ga,H;da=function(c,e,a){var b;b=(c+"").split(".");c=b[0];b=1<b.length?
a+b[1]:"";for(a=/(\d+)(\d{3})/;a.test(c);)c=c.replace(a,"$1"+e+"$2");return c+b};B=function(c){c=d.extend({},{digitsAfterDecimal:2,scaler:1,thousandsSep:",",decimalSep:".",prefix:"",suffix:"",showZero:!1},c);return function(e){if(isNaN(e)||!isFinite(e)||0===e&&!c.showZero)return"";e=da((c.scaler*e).toFixed(c.digitsAfterDecimal),c.thousandsSep,c.decimalSep);return""+c.prefix+e+c.suffix}};y=B();D=B({digitsAfterDecimal:0});ga=B({digitsAfterDecimal:1,scaler:100,suffix:"%"});w={count:function(c){null==
c&&(c=D);return function(){return function(e,a,b){return{count:0,push:function(){return this.count++},value:function(){return this.count},format:c}}}},uniques:function(c,e){null==e&&(e=D);return function(a){var b;b=a[0];return function(a,d,h){return{uniq:[],push:function(e){var a;if(a=e[b],0>J.call(this.uniq,a))return this.uniq.push(e[b])},value:function(){return c(this.uniq)},format:e,numInputs:null!=b?0:1}}}},sum:function(c){null==c&&(c=y);return function(e){var a;a=e[0];return function(b,e,d){return{sum:0,
push:function(b){if(!isNaN(parseFloat(b[a])))return this.sum+=parseFloat(b[a])},value:function(){return this.sum},format:c,numInputs:null!=a?0:1}}}},extremes:function(c,e){null==e&&(e=y);return function(a){var b;b=a[0];return function(a,d,h){return{val:null,sorter:T(null!=a?a.sorters:void 0,b),push:function(a){var e,l,d;a=a[b];if("min"===c||"max"===c)a=parseFloat(a),isNaN(a)||(this.val=Math[c](a,null!=(e=this.val)?e:a));"first"===c&&0>=this.sorter(a,null!=(l=this.val)?l:a)&&(this.val=a);if("last"===
c&&0<=this.sorter(a,null!=(d=this.val)?d:a))return this.val=a},value:function(){return this.val},format:function(b){return isNaN(b)?b:e(b)},numInputs:null!=b?0:1}}}},quantile:function(c,e){null==e&&(e=y);return function(a){var b;b=a[0];return function(a,d,h){return{vals:[],push:function(a){a=parseFloat(a[b]);if(!isNaN(a))return this.vals.push(a)},value:function(){var a;if(0===this.vals.length)return null;this.vals.sort(function(a,b){return a-b});a=(this.vals.length-1)*c;return(this.vals[Math.floor(a)]+
this.vals[Math.ceil(a)])/2},format:e,numInputs:null!=b?0:1}}}},runningStat:function(c,e,a){null==c&&(c="mean");null==e&&(e=1);null==a&&(a=y);return function(b){var l;l=b[0];return function(b,d,k){return{n:0,m:0,s:0,push:function(a){var b;b=parseFloat(a[l]);if(!isNaN(b)){this.n+=1;if(1===this.n)return this.m=b;a=this.m+(b-this.m)/this.n;this.s+=(b-this.m)*(b-a);return this.m=a}},value:function(){if("mean"===c)return 0===this.n?0/0:this.m;if(this.n<=e)return 0;switch(c){case "var":return this.s/(this.n-
e);case "stdev":return Math.sqrt(this.s/(this.n-e))}},format:a,numInputs:null!=l?0:1}}}},sumOverSum:function(c){null==c&&(c=y);return function(e){var a,b;b=e[0];a=e[1];return function(e,d,h){return{sumNum:0,sumDenom:0,push:function(e){isNaN(parseFloat(e[b]))||(this.sumNum+=parseFloat(e[b]));if(!isNaN(parseFloat(e[a])))return this.sumDenom+=parseFloat(e[a])},value:function(){return this.sumNum/this.sumDenom},format:c,numInputs:null!=b&&null!=a?0:2}}}},sumOverSumBound80:function(c,e){null==c&&(c=!0);
null==e&&(e=y);return function(a){var b,d;d=a[0];b=a[1];return function(a,h,k){return{sumNum:0,sumDenom:0,push:function(a){isNaN(parseFloat(a[d]))||(this.sumNum+=parseFloat(a[d]));if(!isNaN(parseFloat(a[b])))return this.sumDenom+=parseFloat(a[b])},value:function(){return(.821187207574908/this.sumDenom+this.sumNum/this.sumDenom+1.2815515655446004*(c?1:-1)*Math.sqrt(.410593603787454/(this.sumDenom*this.sumDenom)+this.sumNum*(1-this.sumNum/this.sumDenom)/(this.sumDenom*this.sumDenom)))/(1+1.642374415149816/
this.sumDenom)},format:e,numInputs:null!=d&&null!=b?0:2}}}},fractionOf:function(c,e,a){null==e&&(e="total");null==a&&(a=ga);return function(){var b;b=1<=arguments.length?ha.call(arguments,0):[];return function(d,g,h){return{selector:{total:[[],[]],row:[g,[]],col:[[],h]}[e],inner:c.apply(null,b)(d,g,h),push:function(a){return this.inner.push(a)},format:a,value:function(){return this.inner.value()/d.getAggregator.apply(d,this.selector).inner.value()},numInputs:c.apply(null,b)().numInputs}}}},countUnique:function(c){return w.uniques(function(e){return e.length},
c)},listUnique:function(c){return w.uniques(function(e){return e.join(c)},function(e){return e})},max:function(c){return w.extremes("max",c)},min:function(c){return w.extremes("min",c)},first:function(c){return w.extremes("first",c)},last:function(c){return w.extremes("last",c)},median:function(c){return w.quantile(.5,c)},average:function(c){return w.runningStat("mean",1,c)},"var":function(c,e){return w.runningStat("var",c,e)},stdev:function(c,e){return w.runningStat("stdev",c,e)}};K=function(c){return{"C\u1ed9ng":c.sum(y),
"C\u1ed9ng s\u1ed1 nguy\u00ean":c.sum(D),"T\u00ednh trung b\u00ecnh":c.average(y),"\u0110\u1ebfm":c.count(D)}}(w);M={"B\u1ea3ng":function(c,e){return L(c,e)}};A={en:{aggregators:K,renderers:M,localeStrings:{renderError:"An error occurred rendering the PivotTable results.",computeError:"An error occurred computing the PivotTable results.",uiRenderError:"An error occurred rendering the PivotTable UI.",selectAll:"Ch\u1ecdn t\u1ea5t c\u1ea3",selectNone:"Ch\u1ecdn None",tooMany:"(too many to list)",filterResults:"Gi\u00e1 tr\u1ecb l\u1ecdc",
apply:"\u00c1p d\u1ee5ng",cancel:"Hu\u1ef7",totals:"C\u1ed9ng",vs:"vs",by:"by"}}};fa="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");ea="Sun Mon Tue Wed Thu Fri Sat".split(" ");H=function(c){return("0"+c).substr(-2,2)};N=/(\d+)|(\D+)/g;C=/\d/;Q=/^0/;G=function(c){return function(e,a){var b,c,d,h;if(null!=a&&null==e)return-1;if(null!=e&&null==a)return 1;if("number"===typeof e&&isNaN(e))return-1;if("number"===typeof a&&isNaN(a))return 1;b=+e;c=+a;if(b<c)return-1;if(b>c)return 1;if("number"===
typeof e&&"number"!==typeof a)return-1;if("number"===typeof a&&"number"!==typeof e)return 1;if("number"===typeof e&&"number"===typeof a)return 0;if(isNaN(c)&&!isNaN(b))return-1;if(isNaN(b)&&!isNaN(c))return 1;b=String(e);d=String(a);if(b===d)return 0;if(!C.test(b)||!C.test(d))return b>d?1:-1;b=b.match(N);for(d=d.match(N);b.length&&d.length;)if(c=b.shift(),h=d.shift(),c!==h)return C.test(c)&&C.test(h)?c.replace(Q,".0")-h.replace(Q,".0"):c>h?1:-1;return b.length-d.length}}(this);T=function(c,e){var a;
if(null!=c)if(d.isFunction(c)){if(a=c(e),d.isFunction(a))return a}else if(null!=c[e])return c[e];return G};S=function(){function c(e,a){var b,d,g,h,k,m,r,q,u,x;null==a&&(a={});this.getAggregator=F(this.getAggregator,this);this.getRowKeys=F(this.getRowKeys,this);this.getColKeys=F(this.getColKeys,this);this.sortKeys=F(this.sortKeys,this);this.arrSort=F(this.arrSort,this);this.input=e;this.aggregator=null!=(b=a.aggregator)?b:w.count()();this.aggregatorName=null!=(d=a.aggregatorName)?d:"Count";this.colAttrs=
null!=(g=a.cols)?g:[];this.rowAttrs=null!=(h=a.rows)?h:[];this.valAttrs=null!=(k=a.vals)?k:[];this.sorters=null!=(m=a.sorters)?m:{};this.rowOrder=null!=(r=a.rowOrder)?r:"key_a_to_z";this.colOrder=null!=(q=a.colOrder)?q:"key_a_to_z";this.derivedAttributes=null!=(u=a.derivedAttributes)?u:{};this.filter=null!=(x=a.filter)?x:function(){return!0};this.tree={};this.rowKeys=[];this.colKeys=[];this.rowTotals={};this.colTotals={};this.allTotal=this.aggregator(this,[],[]);this.sorted=!1;c.forEachRecord(this.input,
this.derivedAttributes,function(a){return function(b){if(a.filter(b))return a.processRecord(b)}}(this))}c.forEachRecord=function(e,a,b){var c,g,h,k,m,r,q,u,x;c=d.isEmptyObject(a)?b:function(e){var c,d,l;for(c in a)l=a[c],e[c]=null!=(d=l(e))?d:e[c];return b(e)};if(d.isFunction(e))return e(c);if(d.isArray(e)){if(d.isArray(e[0])){u=[];for(h in e)if(t.call(e,h)&&(g=e[h],0<h)){r={};q=e[0];for(k in q)t.call(q,k)&&(m=q[k],r[m]=g[k]);u.push(c(r))}return u}k=[];g=0;for(h=e.length;g<h;g++)r=e[g],k.push(c(r));
return k}if(e instanceof jQuery)return x=[],d("thead > tr > th",e).each(function(a){return x.push(d(this).text())}),d("tbody > tr",e).each(function(a){r={};d("td",this).each(function(a){return r[x[a]]=d(this).text()});return c(r)});throw Error("unknown input format");};c.prototype.forEachMatchingRecord=function(e,a){return c.forEachRecord(this.input,this.derivedAttributes,function(b){return function(c){var d,h,k;if(b.filter(c)){for(d in e)if(k=e[d],k!==(null!=(h=c[d])?h:"null"))return;return a(c)}}}(this))};
c.prototype.arrSort=function(e){var a,b;b=function(){var b,c,d;d=[];b=0;for(c=e.length;b<c;b++)a=e[b],d.push(T(this.sorters,a));return d}.call(this);return function(a,c){var e,d;for(d in b)if(t.call(b,d)&&(e=b[d],e=e(a[d],c[d]),0!==e))return e;return 0}};c.prototype.sortKeys=function(){var e;if(!this.sorted){this.sorted=!0;e=function(a){return function(b,e){return a.getAggregator(b,e).value()}}(this);switch(this.rowOrder){case "value_a_to_z":this.rowKeys.sort(function(a){return function(a,c){return G(e(a,
[]),e(c,[]))}}(this));break;case "value_z_to_a":this.rowKeys.sort(function(a){return function(a,c){return-G(e(a,[]),e(c,[]))}}(this));break;default:this.rowKeys.sort(this.arrSort(this.rowAttrs))}switch(this.colOrder){case "value_a_to_z":return this.colKeys.sort(function(a){return function(a,c){return G(e([],a),e([],c))}}(this));case "value_z_to_a":return this.colKeys.sort(function(a){return function(a,c){return-G(e([],a),e([],c))}}(this));default:return this.colKeys.sort(this.arrSort(this.colAttrs))}}};
c.prototype.getColKeys=function(){this.sortKeys();return this.colKeys};c.prototype.getRowKeys=function(){this.sortKeys();return this.rowKeys};c.prototype.processRecord=function(c){var a,b,d,g,h,k,m,r;a=[];r=[];k=this.colAttrs;g=0;for(h=k.length;g<h;g++)d=k[g],a.push(null!=(m=c[d])?m:"null");k=this.rowAttrs;h=0;for(g=k.length;h<g;h++)d=k[h],r.push(null!=(b=c[d])?b:"null");d=r.join(String.fromCharCode(0));b=a.join(String.fromCharCode(0));this.allTotal.push(c);0!==r.length&&(this.rowTotals[d]||(this.rowKeys.push(r),
this.rowTotals[d]=this.aggregator(this,r,[])),this.rowTotals[d].push(c));0!==a.length&&(this.colTotals[b]||(this.colKeys.push(a),this.colTotals[b]=this.aggregator(this,[],a)),this.colTotals[b].push(c));if(0!==a.length&&0!==r.length)return this.tree[d]||(this.tree[d]={}),this.tree[d][b]||(this.tree[d][b]=this.aggregator(this,r,a)),this.tree[d][b].push(c)};c.prototype.getAggregator=function(c,a){var b,d;d=c.join(String.fromCharCode(0));b=a.join(String.fromCharCode(0));b=0===c.length&&0===a.length?this.allTotal:
0===c.length?this.colTotals[b]:0===a.length?this.rowTotals[d]:this.tree[d][b];return null!=b?b:{value:function(){return null},format:function(){return""}}};return c}();d.pivotUtilities={aggregatorTemplates:w,aggregators:K,renderers:M,derivers:{bin:function(c,d){return function(a){return a[c]-a[c]%d}},dateFormat:function(c,d,a,b,l){var g;null==a&&(a=!1);null==b&&(b=fa);null==l&&(l=ea);g=a?"UTC":"";return function(a){var k;k=new Date(Date.parse(a[c]));return isNaN(k)?"":d.replace(/%(.)/g,function(a,
c){switch(c){case "y":return k["get"+g+"FullYear"]();case "m":return H(k["get"+g+"Month"]()+1);case "n":return b[k["get"+g+"Month"]()];case "d":return H(k["get"+g+"Date"]());case "w":return l[k["get"+g+"Day"]()];case "x":return k["get"+g+"Day"]();case "H":return H(k["get"+g+"Hours"]());case "M":return H(k["get"+g+"Minutes"]());case "S":return H(k["get"+g+"Seconds"]());default:return"%"+c}})}}},locales:A,naturalSort:G,numberFormat:B,sortAs:function(c){var d,a,b,l;b={};a={};for(d in c)l=c[d],b[l]=d,
"string"===typeof l&&(a[l.toLowerCase()]=d);return function(d,c){return null!=b[d]&&null!=b[c]?b[d]-b[c]:null!=b[d]?-1:null!=b[c]?1:null!=a[d]&&null!=a[c]?a[d]-a[c]:null!=a[d]?-1:null!=a[c]?1:G(d,c)}},PivotData:S};L=function(c,e){var a,b,l,g,h,k,m,r,q,u,x,Y,w,f,p,v;e=d.extend(!0,{},{table:{clickCallback:null},localeStrings:{totals:"Totals"}},e);l=c.colAttrs;q=c.rowAttrs;x=c.getRowKeys();g=c.getColKeys();e.table.clickCallback&&(h=function(a,d,b){var h,f,g;f={};for(g in l)t.call(l,g)&&(h=l[g],null!=
b[g]&&(f[h]=b[g]));for(g in q)t.call(q,g)&&(h=q[g],null!=d[g]&&(f[h]=d[g]));return function(d){return e.table.clickCallback(d,a,f,c)}});r=document.createElement("table");r.className="pvtTable";Y=function(a,d,c){var b,e,g,h,f;if(0!==d){e=!0;for(f=b=0;0<=c?b<=c:b>=c;f=0<=c?++b:--b)a[d-1][f]!==a[d][f]&&(e=!1);if(e)return-1}for(b=0;d+b<a.length;){h=!1;f=e=0;for(g=c;0<=g?e<=g:e>=g;f=0<=g?++e:--e)a[d][f]!==a[d+b][f]&&(h=!0);if(h)break;b++}return b};u=document.createElement("thead");for(m in l)if(t.call(l,
m)){b=l[m];p=document.createElement("tr");0===parseInt(m)&&0!==q.length&&(f=document.createElement("th"),f.setAttribute("colspan",q.length),f.setAttribute("rowspan",l.length),p.appendChild(f));f=document.createElement("th");f.className="pvtAxisLabel";f.textContent=b;p.appendChild(f);for(k in g)t.call(g,k)&&(b=g[k],v=Y(g,parseInt(k),parseInt(m)),-1!==v&&(f=document.createElement("th"),f.className="pvtColLabel",f.textContent=b[m],f.setAttribute("colspan",v),parseInt(m)===l.length-1&&0!==q.length&&f.setAttribute("rowspan",
2),p.appendChild(f)));0===parseInt(m)&&(f=document.createElement("th"),f.className="pvtTotalLabel",f.innerHTML=e.localeStrings.totals,f.setAttribute("rowspan",l.length+(0===q.length?0:1)),p.appendChild(f));u.appendChild(p)}if(0!==q.length){p=document.createElement("tr");for(k in q)t.call(q,k)&&(b=q[k],f=document.createElement("th"),f.className="pvtAxisLabel",f.textContent=b,p.appendChild(f));f=document.createElement("th");0===l.length&&(f.className="pvtTotalLabel",f.innerHTML=e.localeStrings.totals);
p.appendChild(f);u.appendChild(p)}r.appendChild(u);w=document.createElement("tbody");for(k in x)if(t.call(x,k)){u=x[k];p=document.createElement("tr");for(m in u)t.call(u,m)&&(b=u[m],v=Y(x,parseInt(k),parseInt(m)),-1!==v&&(f=document.createElement("th"),f.className="pvtRowLabel",f.textContent=b,f.setAttribute("rowspan",v),parseInt(m)===q.length-1&&0!==l.length&&f.setAttribute("colspan",2),p.appendChild(f)));for(m in g)t.call(g,m)&&(b=g[m],a=c.getAggregator(u,b),v=a.value(),f=document.createElement("td"),
f.className="pvtVal row"+k+" col"+m,f.textContent=a.format(v),f.setAttribute("data-value",v),null!=h&&(f.onclick=h(v,u,b)),p.appendChild(f));a=c.getAggregator(u,[]);v=a.value();f=document.createElement("td");f.className="pvtTotal rowTotal";f.textContent=a.format(v);f.setAttribute("data-value",v);null!=h&&(f.onclick=h(v,u,[]));f.setAttribute("data-for","row"+k);p.appendChild(f);w.appendChild(p)}p=document.createElement("tr");f=document.createElement("th");f.className="pvtTotalLabel";f.innerHTML=e.localeStrings.totals;
f.setAttribute("colspan",q.length+(0===l.length?0:1));p.appendChild(f);for(m in g)t.call(g,m)&&(b=g[m],a=c.getAggregator([],b),v=a.value(),f=document.createElement("td"),f.className="pvtTotal colTotal",f.textContent=a.format(v),f.setAttribute("data-value",v),null!=h&&(f.onclick=h(v,[],b)),f.setAttribute("data-for","col"+m),p.appendChild(f));a=c.getAggregator([],[]);v=a.value();f=document.createElement("td");f.className="pvtGrandTotal";f.textContent=a.format(v);f.setAttribute("data-value",v);null!=
h&&(f.onclick=h(v,[],[]));p.appendChild(f);w.appendChild(p);r.appendChild(w);r.setAttribute("data-numrows",x.length);r.setAttribute("data-numcols",g.length);return r};d.fn.pivot=function(c,e,a){var b,l,g;null==a&&(a="en");null==A[a]&&(a="en");b={cols:[],rows:[],vals:[],rowOrder:"key_a_to_z",colOrder:"key_a_to_z",dataClass:S,filter:function(){return!0},aggregator:w.count()(),aggregatorName:"Count",sorters:{},derivedAttributes:{},renderer:L};a=d.extend(!0,{},A.en.localeStrings,A[a].localeStrings);b=
d.extend(!0,{},{rendererOptions:{localeStrings:a},localeStrings:a},d.extend({},b,e));e=null;try{g=new b.dataClass(c,b);try{e=b.renderer(g,b.rendererOptions)}catch(h){l=h,"undefined"!==typeof console&&null!==console&&console.error(l.stack),e=d("<span>").html(b.localeStrings.renderError)}}catch(h){l=h,"undefined"!==typeof console&&null!==console&&console.error(l.stack),e=d("<span>").html(b.localeStrings.computeError)}for(c=this[0];c.hasChildNodes();)c.removeChild(c.lastChild);return this.append(e)};
d.fn.pivotUI=function(c,e,a,b){var l,g,h,k,m,r,q,u,x,w,y,f,p,v,H,F,B,C,n,O,D,U,K,L,M,N,I,Q,V,W,Z,E,aa,ba,P,R,ca,X,z;null==a&&(a=!1);null==b&&(b="en");null==A[b]&&(b="en");q={derivedAttributes:{},aggregators:A[b].aggregators,renderers:A[b].renderers,hiddenAttributes:[],menuLimit:500,cols:[],rows:[],vals:[],rowOrder:"key_a_to_z",colOrder:"key_a_to_z",dataClass:S,exclusions:{},inclusions:{},unusedAttrsVertical:85,autoSortUnusedAttrs:!1,onRefresh:null,filter:function(){return!0},sorters:{}};b=d.extend(!0,
{},A.en.localeStrings,A[b].localeStrings);H={rendererOptions:{localeStrings:b},localeStrings:b};b=this.data("pivotUIOptions");n=null==b||a?d.extend(!0,{},H,d.extend({},q,e)):b;try{m={};F=[];U=0;S.forEachRecord(c,n.derivedAttributes,function(a){var d,c,b,e;if(n.filter(a)){F.push(a);for(d in a)t.call(a,d)&&null==m[d]&&(m[d]={},0<U&&(m[d]["null"]=U));for(d in m)e=null!=(b=a[d])?b:"null",null==(c=m[d])[e]&&(c[e]=0),m[d][e]++;return U++}});P=d("<table>",{"class":"pvtUi"}).attr("cellpadding",5);W=d("<td>");
V=d("<select>").addClass("pvtRenderer").appendTo(W).bind("change",function(){return I()});K=n.renderers;for(z in K)t.call(K,z)&&d("<option>").val(z).html(z).appendTo(V);R=d("<td>").addClass("pvtAxisContainer pvtUnused");E=function(){var a;a=[];for(l in m)0>J.call(n.hiddenAttributes,l)&&a.push(l);return a}();X=!1;ca="auto"===n.unusedAttrsVertical?120:parseInt(n.unusedAttrsVertical);if(!isNaN(ca)){y=k=0;for(f=E.length;y<f;y++)l=E[y],k+=l.length;X=k>ca}!0===n.unusedAttrsVertical||X?R.addClass("pvtVertList"):
R.addClass("pvtHorizList");u=function(a){var c,b,e,g,f,h,k,l,r,q,u,v,t,w,p;u=function(){var d;d=[];for(v in m[a])d.push(v);return d}();h=!1;p=d("<div>").addClass("pvtFilterBox").hide();p.append(d("<h4>").append(d("<span>").text(a),d("<span>").addClass("count").text("("+u.length+")")));if(u.length>n.menuLimit)p.append(d("<p>").html(n.localeStrings.tooMany));else for(5<u.length&&(b=d("<p>").appendTo(p),q=T(n.sorters,a),g=n.localeStrings.filterResults,d("<input>",{type:"text"}).appendTo(b).attr({placeholder:g,
"class":"pvtSearch"}).bind("keyup",function(){var a,c,b;b=d(this).val().toLowerCase().trim();c=function(a,d){return function(c){var e,g;e=b.substring(a.length).trim();return 0===e.length?!0:(g=Math.sign(q(c.toLowerCase(),e)),0<=J.call(d,g))}};a=b.startsWith(">=")?c(">=",[1,0]):b.startsWith("<=")?c("<=",[-1,0]):b.startsWith(">")?c(">",[1]):b.startsWith("<")?c("<",[-1]):b.startsWith("~")?function(a){return 0===b.substring(1).trim().length?!0:a.toLowerCase().match(b.substring(1))}:function(a){return-1!==
a.toLowerCase().indexOf(b)};return p.find(".pvtCheckContainer p label span.value").each(function(){return a(d(this).text())?d(this).parent().parent().show():d(this).parent().parent().hide()})}),b.append(d("<br>")),d("<button>",{type:"button"}).appendTo(b).html(n.localeStrings.selectAll).bind("click",function(){p.find("input:visible:not(:checked)").prop("checked",!0).toggleClass("changed");return!1}),d("<button>",{type:"button"}).appendTo(b).html(n.localeStrings.selectNone).bind("click",function(){p.find("input:visible:checked").prop("checked",
!1).toggleClass("changed");return!1})),b=d("<div>").addClass("pvtCheckContainer").appendTo(p),r=u.sort(T(n.sorters,a)),l=0,k=r.length;l<k;l++)t=r[l],w=m[a][t],g=d("<label>"),f=!1,n.inclusions[a]?f=0>J.call(n.inclusions[a],t):n.exclusions[a]&&(f=0<=J.call(n.exclusions[a],t)),h||(h=f),d("<input>").attr("type","checkbox").addClass("pvtFilter").attr("checked",!f).data("filter",[a,t]).appendTo(g).bind("change",function(){return d(this).toggleClass("changed")}),g.append(d("<span>").addClass("value").text(t)),
g.append(d("<span>").addClass("count").text("("+w+")")),b.append(d("<p>").append(g));e=function(){p.find("[type='checkbox']").length>p.find("[type='checkbox']:checked").length?c.addClass("pvtFilteredAttribute"):c.removeClass("pvtFilteredAttribute");p.find(".pvtSearch").val("");p.find(".pvtCheckContainer p").show();return p.hide()};b=d("<p>").appendTo(p);u.length<=n.menuLimit&&d("<button>",{type:"button"}).text(n.localeStrings.apply).appendTo(b).bind("click",function(){p.find(".changed").removeClass("changed").length&&
I();return e()});d("<button>",{type:"button"}).text(n.localeStrings.cancel).appendTo(b).bind("click",function(){p.find(".changed:checked").removeClass("changed").prop("checked",!1);p.find(".changed:not(:checked)").removeClass("changed").prop("checked",!0);return e()});u=d("<span>").addClass("pvtTriangle").html(" &#x25BE;").bind("click",function(a){a=d(a.currentTarget).position();return p.css({left:a.left+10,top:a.top+10}).show()});c=d("<li>").addClass("axis_"+x).append(d("<span>").addClass("pvtAttr").text(a).data("attrName",
a).append(u));h&&c.addClass("pvtFilteredAttribute");return R.append(c).append(p)};for(x in E)t.call(E,x)&&(h=E[x],u(h));aa=d("<tr>").appendTo(P);g=d("<select>").addClass("pvtAggregator").bind("change",function(){return I()});L=n.aggregators;for(z in L)t.call(L,z)&&g.append(d("<option>").val(z).html(z));O={key_a_to_z:{rowSymbol:"&varr;",colSymbol:"&harr;",next:"value_a_to_z"},value_a_to_z:{rowSymbol:"&darr;",colSymbol:"&rarr;",next:"value_z_to_a"},value_z_to_a:{rowSymbol:"&uarr;",colSymbol:"&larr;",
next:"key_a_to_z"}};Z=d("<a>",{role:"button"}).addClass("pvtRowOrder").data("order",n.rowOrder).html(O[n.rowOrder].rowSymbol).bind("click",function(){d(this).data("order",O[d(this).data("order")].next);d(this).html(O[d(this).data("order")].rowSymbol);return I()});r=d("<a>",{role:"button"}).addClass("pvtColOrder").data("order",n.colOrder).html(O[n.colOrder].colSymbol).bind("click",function(){d(this).data("order",O[d(this).data("order")].next);d(this).html(O[d(this).data("order")].colSymbol);return I()});
d("<td>").addClass("pvtVals").appendTo(aa).append(g).append(Z).append(r).append(d("<br>"));d("<td>").addClass("pvtAxisContainer pvtHorizList pvtCols").appendTo(aa);ba=d("<tr>").appendTo(P);ba.append(d("<td>").addClass("pvtAxisContainer pvtRows").attr("valign","top"));D=d("<td>").attr("valign","top").addClass("pvtRendererArea").appendTo(ba);!0===n.unusedAttrsVertical||X?(P.find("tr:nth-child(1)").prepend(W),P.find("tr:nth-child(2)").prepend(R)):P.prepend(d("<tr>").append(W).append(R));this.html(P);
M=n.cols;B=0;for(p=M.length;B<p;B++)z=M[B],this.find(".pvtCols").append(this.find(".axis_"+d.inArray(z,E)));N=n.rows;C=0;for(v=N.length;C<v;C++)z=N[C],this.find(".pvtRows").append(this.find(".axis_"+d.inArray(z,E)));null!=n.aggregatorName&&this.find(".pvtAggregator").val(n.aggregatorName);null!=n.rendererName&&this.find(".pvtRenderer").val(n.rendererName);w=!0;Q=function(a){return function(){var c,b,e,f,k,l,m,q,u,p,t;q={derivedAttributes:n.derivedAttributes,localeStrings:n.localeStrings,rendererOptions:n.rendererOptions,
sorters:n.sorters,cols:[],rows:[],dataClass:n.dataClass};k=null!=(e=n.aggregators[g.val()]([])().numInputs)?e:0;t=[];a.find(".pvtRows li span.pvtAttr").each(function(){return q.rows.push(d(this).data("attrName"))});a.find(".pvtCols li span.pvtAttr").each(function(){return q.cols.push(d(this).data("attrName"))});a.find(".pvtVals select.pvtAttrDropdown").each(function(){if(0===k)return d(this).remove();k--;if(""!==d(this).val())return t.push(d(this).val())});if(0!==k)for(l=a.find(".pvtVals"),z=u=0,
m=k;0<=m?u<m:u>m;z=0<=m?++u:--u){f=d("<select>").addClass("pvtAttrDropdown").append(d("<option>")).bind("change",function(){return I()});p=0;for(e=E.length;p<e;p++)h=E[p],f.append(d("<option>").val(h).text(h));l.append(f)}w&&(t=n.vals,x=0,a.find(".pvtVals select.pvtAttrDropdown").each(function(){d(this).val(t[x]);return x++}),w=!1);q.aggregatorName=g.val();q.vals=t;q.aggregator=n.aggregators[g.val()](t);q.renderer=n.renderers[V.val()];q.rowOrder=Z.data("order");q.colOrder=r.data("order");c={};a.find("input.pvtFilter").not(":checked").each(function(){var a;
a=d(this).data("filter");return null!=c[a[0]]?c[a[0]].push(a[1]):c[a[0]]=[a[1]]});b={};a.find("input.pvtFilter:checked").each(function(){var a;a=d(this).data("filter");if(null!=c[a[0]])return null!=b[a[0]]?b[a[0]].push(a[1]):b[a[0]]=[a[1]]});q.filter=function(a){var b,d,e,f;if(!n.filter(a))return!1;for(d in c)if(b=c[d],e=""+(null!=(f=a[d])?f:"null"),0<=J.call(b,e))return!1;return!0};D.pivot(F,q);e=d.extend({},n,{cols:q.cols,rows:q.rows,colOrder:q.colOrder,rowOrder:q.rowOrder,vals:t,exclusions:c,inclusions:b,
inclusionsInfo:b,aggregatorName:g.val(),rendererName:V.val()});a.data("pivotUIOptions",e);n.autoSortUnusedAttrs&&(f=a.find("td.pvtUnused.pvtAxisContainer"),d(f).children("li").sort(function(a,b){return G(d(a).text(),d(b).text())}).appendTo(f));D.css("opacity",1);if(null!=n.onRefresh)return n.onRefresh(e)}}(this);I=function(a){return function(){D.css("opacity",.5);return setTimeout(Q,10)}}(this);I();this.find(".pvtAxisContainer").sortable({update:function(a,b){if(null==b.sender)return I()},connectWith:this.find(".pvtAxisContainer"),
items:"li",placeholder:"pvtPlaceholder"})}catch(ia){"undefined"!==typeof console&&null!==console&&console.error(ia.stack),this.html(n.localeStrings.uiRenderError)}return this};d.fn.heatmap=function(c,e){var a,b,l,g,h;null==c&&(c="heatmap");g=this.data("numrows");l=this.data("numcols");a=null!=e?null!=(b=e.heatmap)?b.colorScaleGenerator:void 0:void 0;null==a&&(a=function(a){var b,d;d=Math.min.apply(Math,a);b=Math.max.apply(Math,a);return function(a){a=255-Math.round(255*(a-d)/(b-d));return"rgb(255,"+
a+","+a+")"}});b=function(b){return function(c){var e,g,h;g=function(a){return b.find(c).each(function(){var b;b=d(this).data("value");if(null!=b&&isFinite(b))return a(b,d(this))})};h=[];g(function(a){return h.push(a)});e=a(h);return g(function(a,b){return b.css("background-color",e(a))})}}(this);switch(c){case "heatmap":b(".pvtVal");break;case "rowheatmap":for(l=h=0;0<=g?h<g:h>g;l=0<=g?++h:--h)b(".pvtVal.row"+l);break;case "colheatmap":for(g=h=0;0<=l?h<l:h>l;g=0<=l?++h:--h)b(".pvtVal.col"+g)}b(".pvtTotal.rowTotal");
b(".pvtTotal.colTotal");return this};return d.fn.barchart=function(){var c,e,a,b;b=this.data("numrows");this.data("numcols");c=function(a){return function(b){var c,e,m,r;c=function(c){return a.find(b).each(function(){var a;a=d(this).data("value");if(null!=a&&isFinite(a))return c(a,d(this))})};r=[];c(function(a){return r.push(a)});e=Math.max.apply(Math,r);m=function(a){return 100*a/(1.4*e)};return c(function(a,b){var c,e;c=b.text();e=d("<div>").css({position:"relative",height:"55px"});e.append(d("<div>").css({position:"absolute",
bottom:0,left:0,right:0,height:m(a)+"%","background-color":"gray"}));e.append(d("<div>").text(c).css({position:"relative","padding-left":"5px","padding-right":"5px"}));return b.css({padding:0,"padding-top":"5px","text-align":"center"}).html(e)})}}(this);for(e=a=0;0<=b?a<b:a>b;e=0<=b?++a:--a)c(".pvtVal.row"+e);c(".pvtTotal.colTotal");return this}})}).call(this);
